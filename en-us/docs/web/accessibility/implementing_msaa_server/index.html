<!DOCTYPE html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="/apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>Implementing a Microsoft Active Accessibility (MSAA) Server - Accessibility | MDN</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="/static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><meta name="description" content="This document is for developers working to support MSAA in an application in order to make it accessible with 3rd party assistive technologies, as well as for hackers wishing to be involved in Mozilla's MSAA support specifically."><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/Accessibility/Implementing_MSAA_server"><meta property="og:title" content="Implementing a Microsoft Active Accessibility (MSAA) Server - Accessibility | MDN"><meta property="og:description" content="This document is for developers working to support MSAA in an application in order to make it accessible with 3rd party assistive technologies, as well as for hackers wishing to be involved in Mozilla's MSAA support specifically."><meta property="og:locale" content="en-US"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/Implementing_MSAA_server"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="/static/css/main.55b68e13.chunk.css" rel="stylesheet"><script src="/static/js/runtime-main.4bb4c356.js" defer=""></script><script src="/static/js/4.a756dea3.chunk.js" defer=""></script><script src="/static/js/main.d4d565e0.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/API" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="/en-US/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="/en-US/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> 🌐</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> 🌐</a></li></ul></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web"><span property="name">Web technology for developers</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="/en-US/docs/Web/Accessibility"><span property="name">Accessibility</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/Web/Accessibility/Implementing_MSAA_server"><span property="name">Implementing a Microsoft Active Accessibility (MSAA) Server</span></a><meta property="position" content="3"></li></ol></nav></div><aside class="document-toc-container"><section class="document-toc"><header><h2>Table of contents</h2><button type="button" class="ghost toc-trigger-mobile" aria-controls="toc-entries" aria-expanded="false">Table of contents</button></header><ul id="toc-entries"><li><a href="#practical_tips_for_developers_and_how_mozilla_does_it">Practical Tips for Developers and How Mozilla Does It</a></li><li><a href="#contents">Contents</a></li><li><a href="#intro_what_is_msaa">Intro: What is MSAA?</a></li><li><a href="#when_to_use_msaa_and_when_not_to">When to use MSAA, and when not to</a></li><li><a href="#deciding_which_msaa_features_to_support">Deciding Which MSAA Features to Support</a></li><li><a href="#dealing_with_the_quirks_of_msaa">Dealing with the Quirks of MSAA</a></li><li><a href="#example_how_gecko_and_mozilla_implement_msaa">Example: How Gecko and Mozilla Implement MSAA</a></li><li><a href="#feedback">Feedback</a></li></ul></section></aside><main id="content" class="main-content" role="main"><article class="main-page-content" lang="en-US"><h1>Implementing a Microsoft Active Accessibility (MSAA) Server</h1><h2 id="practical_tips_for_developers_and_how_mozilla_does_it"><a href="#practical_tips_for_developers_and_how_mozilla_does_it" title="Permalink to Practical Tips for Developers and How Mozilla Does It">Practical Tips for Developers and How Mozilla Does It</a></h2><div></div><h2 id="contents"><a href="#contents" title="Permalink to Contents">Contents</a></h2><div><p>This document is for developers working to support <abbr title="Microsoft Active Accessibility">MSAA</abbr> in an application in order to make it accessible with 3rd party assistive technologies, as well as for hackers wishing to be involved in Mozilla's MSAA support specifically.</p>

<p>If you're implementing controls/widgets, you should also see the <a href="../toolkit-checklist">Accessible Toolkit Checklist</a>. If you're interested in more about Gecko's MSAA implementation, read <a href="at-apis">Gecko Info for Windows Accessibility Vendors</a> to learn how MSAA clients can utilize Gecko's MSAA support.</p></div><h2 id="intro_what_is_msaa"><a href="#intro_what_is_msaa" title="Permalink to Intro: What is MSAA?">Intro: What is MSAA?</a></h2><div><p>MSAA is the <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd373592.aspx" rel=" noopener"> Microsoft Active Accessibility (MSAA) API</a>, used on Windows operating systems to support assistive technologies for users with disabilities.</p>

<p>Third party assistive technology, such as screen readers, screen magnifiers and voice input software, want to track what's happening inside Mozilla. They need to know about focus changes and other events, and it needs to know what objects are contained in the current document or dialog box. Using this information, a screen reader will speak out loud important changes to the document or UI, and allow the user to track where they navigate. The screen reader user can navigate the web page using screen reader commands or browser commands, and the two pieces of software must remain in sync. Some screen readers can even show information on a <a class="ex-ref external" href="http://www.deafblind.com/display.html" rel=" noopener">refreshable braille display</a>. Screen magnifiers will zoom to the focus, keeping it on the screen at all times, or even allow the user to enter a special low vision document reading mode, with a variety of features such as ticker mode where text is streamed on a single line. Finally, voice dictation software needs to know what's in the current document or UI in order to implement "say what you see" kinds of features.</p>

<p>On Microsoft Windows, these kinds of assistive technology acquire this necessary information via a combination of hacks, MSAA and proprietary DOMs. MSAA is supposed to be the "right way" for accessibility aids to get information, but sometimes the hacks are more effective. For example, screen readers look for screen draws of a vertical blinking line, to determine the location of the caret. Without doing this, screen readers would not be able to let the user know where there caret has moved to in most programs, because so many applications do not use the system caret (Gecko does not). This is so commonly done, that no one even bothers to support the MSAA caret, after all the hack is general solution works with pretty much all applications.</p>

<p>MSAA provides information in several different ways:</p>

<ol>
 <li>A COM interface (IAccessible) that allows applications to expose the tree of data nodes that make up each window in the user interface currently being interacted with and</li>
 <li>Custom interface extensions via interfaces via QueryInterface and QueryService. This can provide assistive technology with contextual information specific to your object model. For example, Gecko support ISimpleDOMNode to provide information about the DOM node for an accessible object.</li>
 <li>A set of system messages that confer accessibility-related events such as focus changes, changes to document content and state changes in UI objects like checkboxes.</li>
</ol>

<p>To really learn about MSAA, you need to download the entire <a class="ex-ref external" href="https://www.microsoft.com/download/en/details.aspx?id=3138" rel=" noopener"> MSAA SDK</a>. Without downloading the <abbr title="Software Development Kit">SDK</abbr>, you won't get the extremely useful tools, which help a great deal in the learning process. The Accessible Event Watcher shows what accessible events are being generated by a given piece of software. The Accessible Explorer and Inspect Object tools show the tree of data nodes the Accessible object is exposing through COM, and what the screen boundaries of each object are. In addition, MSDN has improved their <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd373592.aspx" rel=" noopener"> MSAA documentation</a>.</p></div><h2 id="when_to_use_msaa_and_when_not_to"><a href="#when_to_use_msaa_and_when_not_to" title="Permalink to When to use MSAA, and when not to">When to use MSAA, and when not to</a></h2><div><p>It's a common mistake to say that MSAA is not worth using, for a number of reasons.</p></div><h3 id="myths_for_not_using_msaa"><a href="#myths_for_not_using_msaa" title="Permalink to Myths for not using MSAA">Myths for not using MSAA</a></h3><div><p><span class="c1">Myth: MSAA doesn't really work</span><br>
 Reality: MSAA works really well for dialogs and UI. True, it's not great for documents, but it's the only existing widely-used standard for exposing accessibility.</p>

<p><span class="c1">Myth: MSAA is too slow</span><br>
 Reality: Assistive technology vendors have found ways around most of the performance problems related to out-of-process COM method calls. Just make sure to have decent performance on your end.</p>

<p><span class="c1">Myth: "MSAA sucks"</span><br>
 Reality: This statement may come from another engineer or even an employee of an AT vendor. And what are they recommending for an alternative, a proprietary solution? MSAA is by no means perfect, but it is the only thing that will make your custom UI elements work with most assistive technologies. Try to be careful that AT vendors do not lock you into a proprietary solution that will work with only their products.</p>

<p><span class="c1">Related Myth: MSAA is not supported by AT vendors</span><br>
 Reality: It's a standard, and it is supported by JAWS, Window-Eyes, ZoomText, Dragon and Supernova/HAL. There's currently nothing better.</p>

<p><span class="c1">Myth: MSAA has no documentation</span><br>
 Reality: You're reading useful documentation right here. The docs on <abbr title="Microsoft Developer Network">MSDN</abbr> are useful as well.</p>

<p><span class="c1">Mostly myth: MSAA is too expensive to implement</span><br>
 Reality: *Too* expensive is relative, and depends on how important accessibility is for your project. This document's <a href="#cheatsheets">Deciding Which MSAA Features to Support</a> section attempts to lower the cost by showing which parts of MSAA are not very important to work on. You only need to support MSAA on the non-standard controls in your app. So, it's not too bad.</p>

<p><span class="c1">Mostly myth: Microsoft is abandoning MSAA in Longhorn</span><br>
 Reality: Microsoft's accessibility strategy is changing to a new API in Longhorn. MSAA will still be supported through an emulation layer, but that will probably be a very slow solution. We'll have to wait and see how good the MSAA support in Longhorn is, before we can call this one.</p></div><h3 id="msaa_decision-making_guide"><a href="#msaa_decision-making_guide" title="Permalink to MSAA decision-making guide">MSAA decision-making guide</a></h3><div><ul>
 <li><span class="MSAA_decision">Use MSAA</span> whenever you have created custom controls where you're handling the drawing, mouse and keyboard accessibility in your own code. MSAA is the only way to let all AT's know what your code is doing.</li>
</ul>

<ul>
 <li><span class="MSAA_decision">Don't use MSAA</span> if you're not running on a Windows platform ... hope that one was obvious.</li>
 <li><span class="MSAA_decision">Don't use MSAA</span> if your only Windows target for accessibility is Longhorn.</li>
 <li><span class="MSAA_decision">Don't use MSAA</span> if you're not going to take it all the way via testing with assistive technologies and working with AT vendors.</li>
 <li><span class="MSAA_decision">Don't use MSAA</span> for exposing documents or other specialized data, if it's important that the user get access to formatting information. You will have to expose interfaces that contain more info than MSAA does. This information may be in the form of extensions to MSAA, like Mozilla has done with <a href="at-apis#externaldom">ISimpleDOMNode</a> (you can QI to it from IAccessible). This is likely to be a painful road even if you are a major player, in terms of getting the cooperation of AT vendors. It may be a good enough solution; however, if what you need is JAWS, Dragon and ZoomText support. ZoomText and Dragon can get by with your MSAA support., and JAWS can be scripted (even by external developers) to support alternative interfaces.</li>
 <li><span class="MSAA_decision">Don't use MSAA</span> if you're working with a small number of AT vendors, you can get everyone to agree on a different solution, and you're sure that you won't be needing to support other assistive technologies later.</li>
</ul></div><h2 id="deciding_which_msaa_features_to_support"><a href="#deciding_which_msaa_features_to_support" title="Permalink to Deciding Which MSAA Features to Support">Deciding Which MSAA Features to Support</a></h2><div></div><h3 id="msaa_methods_-_cheat_sheet_for_developers"><a href="#msaa_methods_-_cheat_sheet_for_developers" title="Permalink to MSAA Methods - Cheat Sheet for Developers">MSAA Methods - Cheat Sheet for Developers</a></h3><div><p>The IAccessible interface is used in a tree of IAccessible's, each one representing a data node, similar to a DOM.</p>

<p>Here are the methods supported in IAccessible - a minimal implementation would contain those marked "<strong>[important]</strong>":</p>

<ul>
 <li>get_accParent: Get the parent of an IAccessible. <strong>[important]</strong></li>
 <li>get_accChildCount: Get the number of children of an IAccessible. <strong>[important]</strong></li>
 <li>get_accChild: Get the child of an IAccessible. <strong>[important]</strong></li>
 <li>get_accName: Get the "name" of the IAccessible, for example the name of a button, checkbox or menu item. Try to use unique names for each item in a dialog so that voice dictation software doesn't have to deal with extra ambiguity.<strong>[important]</strong></li>
 <li>get_accValue: Get the "value" of the IAccessible, for example a number in a slider, a URL for a link, the text a user entered in a field. <strong>[important]</strong></li>
 <li>get_accDescription: Get a long description of the current IAccessible. This is not really too useful.</li>
 <li>get_accRole: Get an enumerated value representing what this IAccessible is used for, for example.<br>
  is it a link, static text, editable text, a checkbox, or a table cell, etc. <strong>[important]</strong></li>
 <li>get_accState: a 32 bit field representing possible on/off states, such as focused, focusable, selected, selectable, visible, protected (for passwords), checked, etc. <strong>[important]</strong></li>
 <li>get_accHelp: Get context sensitive help for the IAccessible.</li>
 <li>get_accHelpTopic: We don't use this, it's only if the Windows help system is used.</li>
 <li>get_accKeyboardShortcut: What is the keyboard shortcut for this IAccessible (underlined alt+combo mnemonic)</li>
 <li>get_accFocus: Which child is focused? <strong>[important]</strong></li>
 <li>get_accSelection: Which children of this item are selected?</li>
 <li>get_accDefaultAction: Get a description or name of the default action for this component, such as "jump" for links.</li>
 <li>accSelect: Select the item associated with this IAccessible. <strong>[important]</strong></li>
 <li>accLocation: Get the x,y coordinates, and the height and width of this IAccessible node. <strong>[important]</strong></li>
 <li>accNavigate: Navigate to the first/last child, previous/next sibling, up, down, left or right from this IAccessible. <strong>[important, but no need to implement up/down/left/right]</strong></li>
 <li>accHitTest: Find out what IAccessible exists and a specific coordinate.</li>
 <li>accDoDefaultAction: Perform the action described by get_accDefaultAction.</li>
 <li>put_accName: Change the name.</li>
 <li>put_accValue: Change the value.</li>
</ul></div><h3 id="msaa_events_cheat_sheet"><a href="#msaa_events_cheat_sheet" title="Permalink to MSAA Events Cheat Sheet">MSAA Events Cheat Sheet</a></h3><div><p>For information on what each event does, see the <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd318066.aspx" rel=" noopener"> MSDN Event Constants page</a>.</p>

<p>Check with your assistive technology partners to find out what events you need to support. There's a very good chance they won't ask for more than the events marked <strong>[important]</strong>:</p>

<table class="c5">
 <tbody>
  <tr>
   <td>EVENT_SYSTEM_SOUND<br>
    EVENT_SYSTEM_ALERT <strong>[can be important, to have auto-speaking for newly created ROLE_ALERTs]</strong><br>
    EVENT_SYSTEM_FOREGROUND<br>
    EVENT_SYSTEM_MENUSTART <strong>[important]</strong><br>
    EVENT_SYSTEM_MENUEND <strong>[important]</strong><br>
    EVENT_SYSTEM_MENUPOPUPSTART <strong>[important]</strong><br>
    EVENT_SYSTEM_MENUPOPUPEND <strong>[important]</strong><br>
    EVENT_SYSTEM_CAPTURESTART<br>
    EVENT_SYSTEM_CAPTUREEND<br>
    EVENT_SYSTEM_MOVESIZESTART<br>
    EVENT_SYSTEM_MOVESIZEEND<br>
    EVENT_SYSTEM_CONTEXTHELPSTART<br>
    EVENT_SYSTEM_CONTEXTHELPEND<br>
    EVENT_SYSTEM_DRAGDROPSTART<br>
    EVENT_SYSTEM_DRAGDROPEND<br>
    EVENT_SYSTEM_DIALOGSTART<br>
    EVENT_SYSTEM_DIALOGEND<br>
    EVENT_SYSTEM_SCROLLINGSTART<br>
    EVENT_SYSTEM_SCROLLINGEND <strong>[possibly important, talk to AT vendor]</strong><br>
    EVENT_SYSTEM_SWITCHSTART<br>
    EVENT_SYSTEM_SWITCHEND<br>
    EVENT_SYSTEM_MINIMIZESTART<br>
    EVENT_SYSTEM_MINIMIZEEND</td>
   <td>EVENT_OBJECT_CREATE <strong>[don't implement, watching system generated versions of this event causes</strong> <strong>assistive technology crashes]</strong><br>
    EVENT_OBJECT_DESTROY <strong>[don't implement, watching system generated versions of this event causes assistive technology crashes]</strong><br>
    EVENT_OBJECT_SHOW <strong>[can be important, depending on project]</strong><br>
    EVENT_OBJECT_HIDE <strong>[can be important, depending on project]</strong><br>
    EVENT_OBJECT_REORDER <strong>[important for mutating docs]</strong><br>
    EVENT_OBJECT_FOCUS <strong>[important]</strong><br>
    EVENT_OBJECT_SELECTION <strong>[important]</strong><br>
    EVENT_OBJECT_SELECTIONADD <strong>[important for multiple selection]</strong><br>
    EVENT_OBJECT_SELECTIONREMOVE <strong>[important for multiple selection]</strong><br>
    EVENT_OBJECT_SELECTIONWITHIN <strong>[important for multiple selection]</strong><br>
    EVENT_OBJECT_STATECHANGE <strong>[important for checkboxes and radio buttons]</strong><br>
    EVENT_OBJECT_LOCATIONCHANGE<br>
    EVENT_OBJECT_NAMECHANGE<br>
    EVENT_OBJECT_DESCRIPTIONCHANGE<br>
    EVENT_OBJECT_VALUECHANGE <strong>[important for sliders and progress meters]</strong><br>
    EVENT_OBJECT_PARENTCHANGE<br>
    EVENT_OBJECT_HELPCHANGE<br>
    EVENT_OBJECT_DEFACTIONCHANGE<br>
    EVENT_OBJECT_ACCELERATORCHANGE</td>
  </tr>
 </tbody>
</table></div><h3 id="msaa_states_cheat_sheet"><a href="#msaa_states_cheat_sheet" title="Permalink to MSAA States Cheat Sheet">MSAA States Cheat Sheet</a></h3><div><p>For information on what each state does, see the <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd373609.aspx" rel=" noopener"> MSDN State Constants page</a>.</p>

<p>Check with your assistive technology partners to find out what states you need to support. There's a very good chance they won't ask for more than the states marked <strong>[important]</strong>:</p>

<table class="c5">
 <tbody>
  <tr>
   <td>STATE_UNAVAILABLE <strong>[important]</strong><br>
    STATE_SELECTED <strong>[important]</strong><br>
    STATE_FOCUSED <strong>[important]</strong><br>
    STATE_PRESSED<br>
    STATE_CHECKED <strong>[important]</strong><br>
    STATE_MIXED<br>
    STATE_READONLY <strong>[important]</strong><br>
    STATE_HOTTRACKED<br>
    STATE_DEFAULT <strong>[important]</strong><br>
    STATE_EXPANDED <strong>[important]</strong><br>
    STATE_COLLAPSED <strong>[important]</strong><br>
    STATE_BUSY <strong>[important]</strong><br>
    STATE_FLOATING<br>
    STATE_MARQUEED<br>
    STATE_ANIMATED<br>
    STATE_INVISIBLE</td>
   <td>STATE_OFFSCREEN <strong>[important]</strong><br>
    STATE_SIZEABLE<br>
    STATE_MOVEABLE<br>
    STATE_SELFVOICING<br>
    STATE_FOCUSABLE <strong>[important]</strong><br>
    STATE_SELECTABLE <strong>[important]</strong><br>
    STATE_LINKED <strong>[important]</strong><br>
    STATE_TRAVERSED <strong>[important]</strong><br>
    STATE_MULTISELECTABLE <strong>[important]</strong><br>
    STATE_EXTSELECTABLE<br>
    STATE_ALERT_LOW<br>
    STATE_ALERT_MEDIUM<br>
    STATE_ALERT_HIGH<br>
    STATE_PROTECTED <strong>[important]</strong><br>
    STATE_HASPOPUP</td>
  </tr>
 </tbody>
</table></div><h3 id="msaa_roles_cheat_sheet"><a href="#msaa_roles_cheat_sheet" title="Permalink to MSAA Roles Cheat Sheet">MSAA Roles Cheat Sheet</a></h3><div><p>For information on what each role does, see the <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd373608.aspx" rel=" noopener"> MSDN Role Constants page</a>.</p>

<p>Check with your assistive technology partners to find out what roles you need to support. There's a very good chance they won't ask for more than the roles marked <strong>[important]</strong>:<br>
 There is no need to support the objects marked <strong>[inserted by system].</strong> Windows will add those objects to your hierarchy for you.</p>

<table class="c5">
 <tbody>
  <tr>
   <td>ROLE_TITLEBAR <strong>[inserted by system]</strong><br>
    ROLE_MENUBAR <strong>[important if you don't use native menus]</strong><br>
    ROLE_SCROLLBAR<br>
    ROLE_GRIP<br>
    ROLE_SOUND<br>
    ROLE_CURSOR<br>
    ROLE_CARET<br>
    ROLE_ALERT<br>
    ROLE_WINDOW <strong>[inserted by system]</strong><br>
    ROLE_CLIENT <strong>[important]</strong><br>
    ROLE_MENUPOPUP <strong>[important]</strong><br>
    ROLE_MENUITEM <strong>[important]</strong><br>
    ROLE_TOOLTIP<br>
    ROLE_APPLICATION<br>
    ROLE_DOCUMENT<br>
    ROLE_PANE <strong>[important]</strong><br>
    ROLE_CHART<br>
    ROLE_DIALOG <strong>[semi-important, not currently used by all AT's]</strong><br>
    ROLE_BORDER<br>
    ROLE_GROUPING<br>
    ROLE_SEPARATOR <strong>[important]</strong><br>
    ROLE_TOOLBAR<br>
    ROLE_STATUSBAR <strong>[important]</strong><br>
    ROLE_TABLE <strong>[important]</strong><br>
    ROLE_COLUMNHEADER<br>
    ROLE_ROWHEADER<br>
    ROLE_COLUMN<br>
    ROLE_ROW<br>
    ROLE_CELL <strong>[important]</strong><br>
    ROLE_LINK <strong>[important]</strong><br>
    ROLE_HELPBALLOON<br>
    ROLE_CHARACTER</td>
   <td>ROLE_LIST <strong>[important]</strong><br>
    ROLE_LISTITEM <strong>[important]</strong><br>
    ROLE_OUTLINE <strong>[important]</strong><br>
    ROLE_OUTLINEITEM <strong>[important]</strong><br>
    ROLE_PAGETAB <strong>[important]</strong><br>
    ROLE_PROPERTYPAGE <strong>[important]</strong><br>
    ROLE_INDICATOR<br>
    ROLE_GRAPHIC <strong>[important]</strong><br>
    ROLE_STATICTEXT <strong>[important]</strong><br>
    ROLE_TEXT <strong>[important]</strong><br>
    ROLE_PUSHBUTTON <strong>[important]</strong><br>
    ROLE_CHECKBUTTON <strong>[important]</strong><br>
    ROLE_RADIOBUTTON <strong>[important]</strong><br>
    ROLE_COMBOBOX <strong>[important]</strong><br>
    ROLE_DROPLIST <strong>[important]</strong><br>
    ROLE_PROGRESSBAR <strong>[important]</strong><br>
    ROLE_DIAL<br>
    ROLE_HOTKEYFIELD<br>
    ROLE_SLIDER<br>
    ROLE_SPINBUTTON<br>
    ROLE_DIAGRAM<br>
    ROLE_ANIMATION<br>
    ROLE_EQUATION<br>
    ROLE_BUTTONDROPDOWN<br>
    ROLE_BUTTONMENU<br>
    ROLE_BUTTONDROPDOWNGRID<br>
    ROLE_WHITESPACE<br>
    ROLE_PAGETABLIST <strong>[important]</strong><br>
    ROLE_CLOCK<br>
    ROLE_SPLITBUTTON<br>
    ROLE_IPADDRESS<br>
    ROLE_NOTHING</td>
  </tr>
 </tbody>
</table></div><h3 id="msaa_object_identifiers_cheat_sheet"><a href="#msaa_object_identifiers_cheat_sheet" title="Permalink to MSAA Object Identifiers Cheat Sheet">MSAA Object Identifiers Cheat Sheet</a></h3><div><p class="note">For information on what each object identifier does, see the <a class="ex-ref external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd373606.aspx" rel=" noopener"> MSDN Object Identifiers Constants page</a>.</p>

<p>Check with our assistive technology partners to find out what object identifiers you need to support. There's a very good chance they won't ask for more than the object identifiers marked <strong>[important]</strong>:</p>

<dl>
 <dt id="objid_alert_objid_caret_objid_client">OBJID_ALERT, OBJID_CARET, OBJID_CLIENT</dt>
 <dd>[important]</dd>
 <dt id="objid_cursor_objid_hscroll_objid_nativeom">OBJID_CURSOR, OBJID_HSCROLL, OBJID_NATIVEOM</dt>
 <dd>[important? might be useful for supporting custom interfaces, need to research]</dd>
 <dt id="objid_menu_objid_queryclassnameidx_objid_sizegrip_objid_sound_objid_sysmenu_objid_titlebar_objid_vscroll_objid_window">OBJID_MENU, OBJID_QUERYCLASSNAMEIDX, OBJID_SIZEGRIP, OBJID_SOUND, OBJID_SYSMENU, OBJID_TITLEBAR, OBJID_VSCROLL, OBJID_WINDOW</dt>
 <dd>[important, but implemented automatically by Microsoft Windows. Will return object of type ROLE_WINDOW. See <a href="#windowfromaccessibleobject">WindowFromAccessibleObject quirk explanation</a> below.]</dd>
</dl></div><h2 id="dealing_with_the_quirks_of_msaa"><a href="#dealing_with_the_quirks_of_msaa" title="Permalink to Dealing with the Quirks of MSAA">Dealing with the Quirks of MSAA</a></h2><div><p>MSAA has a well deserved reputation for quirkiness. It is not "plug and play", and will take a lot of testing/refinement before your solution works with any product. Here are some of its quirks and some solutions/workarounds:</p></div><h3 id="msaa_can_be_crash_prone"><a href="#msaa_can_be_crash_prone" title="Permalink to MSAA can be crash prone">MSAA can be crash prone</a></h3><div><p><span class="c1">Problem</span>: Many of MSAA's crash occur because more than one process is refcounting the same objects, and because pointers are being shared between processes. When your application closes, different signals are typically broadcast. For example, the application window closes and the window is blurred. It is impossible to know if and when the 3rd party assistive technology will use one of these signals to release the objects of yours that it is refcounting. This can lead to crashes where it releases something and the wrong time, when some of your dll's are unloaded but not others, and a destructor is called in an unloaded DLL.</p>

<p><span class="c1">Solution</span>: Create a "shutdown" method for each internal accessible object, to remove any references to other internal objects before any of your dll's are unloaded. In order to do this effectively, you will have to keep track of every accessible object that you create. The shutdown method for an accessibility object should be called whenever the document or UI object it refers to goes away. The easiest way to do that is to keep a pointer to an accessible in each internal UI object. If that pointer is non-null, then there is an accessible object for it. Whenever the UI object is destroyed, shutdown it's accessible object as well. In Gecko/Mozilla we are not allowed to keep this extra pointer for each accessible object, so when accessibility is turned on we use a hash table to cache these objects. Such a cache must be kept in perfect sync with the tree of UI and document objects, which is difficult. Therefore, unless 4 bytes extra on each object is critical in your application, just keep the extra pointer around instead of using a hash table.</p>

<p>Also, don't implement EVENT_OBJECT_CREATE or EVENT_OBJECT_DESTROY. Vendors have found that watching these events causes crashes.</p></div><h3 id="hacky_caret_tracking_causes_problems"><a href="#hacky_caret_tracking_causes_problems" title="Permalink to Hacky caret tracking causes problems">Hacky caret tracking causes problems</a></h3><div><p><span class="c1">Problem</span>: Assistive technologies do not use the MSAA caret. They follow screen draws, looking for a vertical blinking line. Unfortunately, some products can get confused by the vertical lines on other objects, such as list boxes, even though those lines are not blinking. The assistive technology may not see your caret at all.</p>

<p><span class="c1">Solution</span>: Make sure there is a configuration file for each assistive technology specific to your application. Read the manual or help, and find the keystroke or commands for training the caret, and save this information in the configuration file. Make sure the caret always has the same width (1px or 2px) within a given window class. Don't support the MSAA caret unless you need Home Page Reader's desktop reader application to work with your application -- no one else uses the MSAA caret.</p></div><h3 id="hacky_highlight_tracking_causes_problems"><a href="#hacky_highlight_tracking_causes_problems" title="Permalink to Hacky highlight tracking causes problems">Hacky highlight tracking causes problems</a></h3><div><p><span class="c1">Problem</span>: Screen readers ignore the MSAA focus whenever a highlight bar moves, speaking the current highlighted text instead. The implementation of automated highlight tracking reads any text that is currently highlighted, even if it resides in several places on the screen. It does not take into account the problems that commonly occur with this feature, such as speaking the wrong thing, speaking the right thing twice or speaking two different things. Problems can easily happen merely by having two listboxes visible at the same time, because selected listbox items use the system highlight color, even when the listbox itself is not focused. Other problems occur when a piece of static text which has the same color background, which will cause that text to be repeated each time the focus or highlight moves. At least one major screen reader has a feature to turn highlight tracking off, but that's only a global setting, and turning off highlight tracking globally also turns off the speaking of menu items.</p>

<p><span class="c1">Solution</span>: Don't use the system highlight color for items that you don't want spoken when the highlight or focus moves. To fix this for standard listboxes, use owner drawn list items, so that you can change the highlight color when an item doesn't have focus. For listboxes that are not focused, use a different highlight color, to give the appearance that the listbox is no longer focused -- a lighter color for unfocused lists will also make the listbox state more visually obvious and thus more usable for everyone. For popup listboxes used for dropdowns in autocomplete text fields, change the color value by 1 when the user is typing in the textfield as opposed to arrowing through the list. The listbox will still visually appear to be active, but the screen reader behavior is improved by not echoing too much spoken information for each keypress. One downside to this solution is that means that you cannot use "client data" for the list items, because Windows won't allow owner drawn list items to use client data.</p></div><h3 id="event_window_handle_is_incorrect"><a href="#event_window_handle_is_incorrect" title="Permalink to Event window handle is incorrect">Event window handle is incorrect</a></h3><div><p><span class="c1">Problem</span>: The screen reader or other assistive technology does not track the focus or other events correctly.</p>

<p><span class="c1">Solution</span>: This may be because you are reporting that the events in a different window from the current system focus. The assistive technology may be asking GetGUIThreadInfo for its hwndFocus, and throwing away MSAA events that are not in the currently focused window. Even if you are visibly showing window focus on the correct window, you must also tell the operating system to focus this window before any other accessibility events get fired in it.</p></div><h3 id="confusion_with_system-generated_events"><a href="#confusion_with_system-generated_events" title="Permalink to Confusion with system-generated events">Confusion with system-generated events</a></h3><div><p><span class="c1">Problem</span>: When you test with Accessible Event Watcher in the MSAA SDK, you will see many events that your application did not generate. Microsoft Windows generates some events for you. These can be problematic, because the assistive technology has no way to tell whether the event came from your application or from Windows. For example, when you set window focus, Windows will generate an EVENT_OBJECT_FOCUS event and a ROLE_WINDOW object it also generated for you. If you happen to set window focus after you fired your own EVENT_OBJECT_FOCUS event on an object in the window, your event will be ignored, because assistive technology software tends to pay attention only to the last focus event.</p>

<p><span class="c1">Solution</span>: When an object is about to get focused in a different window, make sure you focus a window before you fire your own focus events for objects inside it. Test using Accessible Event Watcher in the MSAA SDK, and use the settings panel to watch subsets of accessibility events. Count on the assistive technology to make sense out the jumble of extra system-generated events, it's not your problem.</p></div><h3 id="no_unique_child_id_for_event_target_in_window"><a href="#no_unique_child_id_for_event_target_in_window" title="Permalink to No unique child ID for event target in window">No unique child ID for event target in window</a></h3><div><p><span class="c1">Problem</span>: MSAA expects events to be reported using NotifyWinEvent(eventNum, hWnd, worldID, childID), and there may not be an obvious way to get a window handle and a 32 bit childID for an object. You may be using windowless controls, or have an entire document with lots of objects in a given window. The child ID must be unique, because this is what the assistive technology will use to retrieve the accessible via AccessibleObjectFromEvent() which ends up using get_accChild on the accessible for the given window.</p>

<p><span class="c1">Solution</span>: In Gecko/Mozilla, we did not want to store an extra 32 bit unique ID value on every object. Instead, we hand back a 32 bit value derived from the UI object's pointer, which is unique. We ensure that the value we hand back is always negative. When the get_accChild call comes back, we check our hash table cache for that window to see if there's an accessible object still associated with that unique value. This means the client must use AccessibleObjectFromEvent immediately, because there is a danger that the object will go away, and another different object will be created with the same pointer value.That case seems extremely remote, because information from events is generally retrieved right after the event.</p>

<p>If you're not using a hash table to keep track of unique ID's, store the child ID's and objects for the last 50 or so events in a circular array. In practice, this is enough to keep AccessibleObjectFromEvent() happy.</p></div><h3 id="missing_functionality_in_msaa_2"><a href="#missing_functionality_in_msaa_2" title="Permalink to Missing functionality in MSAA">Missing functionality in MSAA</a></h3><div><p><span class="c1">Problem and solutions:</span> Assistive technology vendors need some things which MSAA does not provide, such as:</p>

<ul>
 <li>No way of signifying that a document has finished loading. Fire EVENT_OBJECT_STATECHANGE for a window/client/pane object when it starts to load a new document. Use STATE_BUSY to indicate that a new document is being loaded. When the loading has finished, fire another EVENT_OBJECT_STATECHANGE event and clear the STATE_BUSY flag.</li>
 <li>No method to get clipped/unclipped bounds of a piece of text within a text object. This is needed by screen magnifiers. No scrollTo method, also needed by screen magnifiers. Implement a custom interface for text objects, and support it through QueryInterface or QueryService if it's being implemented on a different object than IAccessible is. Support a scrollTo method which takes a text index, and a getClippedBounds and getUnclippedBounds method which takes a start and end index. Publish your custom interface.</li>
 <li>No way for assistive technology to know when scrolling has stopped. Fire the EVENT_SYSTEM_SCROLLINGEND event to indicate when scrolling has ended (try not to fire too many of these, wait until scrolling has truly stopped). There is no need to support EVENT_SYSTEM_SCROLLINGSTART, it is not used by assistive technology.</li>
 <li>No support for document formatting or "DOM" as requested by some vendors: support a custom interface that gives them the formatting information they are requesting.</li>
</ul></div><h3 id="dueling_text_equivalents"><a href="#dueling_text_equivalents" title="Permalink to Dueling text equivalents">Dueling text equivalents</a></h3><div><p><span class="c1">Problem</span>: There are three kinds of text equivalents, and it is difficult to know when to use each. Different applications behave differently in this regard. For example, Acrobat uses accessible value for text labels where as most programs use accessible name.</p>

<p><span class="c1">Solution</span>: Be as consistent with Internet Explorer as possible. Use accessible name for most text equivalents, and accessible value for URL's. Don't use accessible description unless you really do have a long description for the object you need to expose -- most assistive technology makes little use of it.</p></div><h3 id="dueling_text_roles"><a href="#dueling_text_roles" title="Permalink to Dueling text roles">Dueling text roles</a></h3><div><p><span class="c1">Problem</span>: There are two different roles for text objects, ROLE_STATICTEXT and ROLE_TEXT. ROLE_TEXT is supposed to mean editable text, yet it is sometimes used in conjunction with STATE_READONLY. It's difficult to know when to use which role plus readonly state combination. For example, Internet Explorer uses ROLE_TEXT without STATE_READONLY and ROLE_TEXT with STATE_READONLY for ordinary web page text. However, it uses ROLE_STATICTEXT for labels.</p>

<p><span class="c1">Solution</span>: Use ROLE_STATICTEXT for labels specific to dialog and UI controls, and always use ROLE_TEXT for document text even if the text is not editable (in that case use ROLE_TEXT with STATE_READONLY). Use ROLE_TEXT with the readonly flag cleared for editable text fields.</p></div><h3 id="issues_with_links"><a href="#issues_with_links" title="Permalink to Issues with Links">Issues with Links</a></h3><div><p><span class="c1">Problem</span>: Some assistive technologies have inflexible heuristics when it comes to reading links. They may not read the object unless the states are correctly set. Second, they can mishandle the object if it cannot parse the whitespace according to its own rules. Most assistive technologies don't know what to do with links embedded in a dialog, as it's becoming more common.</p>

<p><span class="c1">Solution</span>: For links inside documents, make sure the ROLE_LINK object and its child ROLE_TEXT objects all have STATE_LINKED set. For multi-line links with a line break in the middle, make sure there is no whitespace at the beginning or end of any of the accessible names, and make sure there is a \r\n where the line breaks occur in the accessible name for the ROLE_LINK. For an example of how to do this properly, see Internet Explorer or Gecko. Again, if it's not done exactly this way, some links will not be read.</p>

<p>For links inside dialogs, just expose a single ROLE_LINK object and work on a scripting or code change solution with the assistive technology vendor.</p></div><h3 id="issues_with_tree_views"><a href="#issues_with_tree_views" title="Permalink to Issues with Tree Views">Issues with Tree Views</a></h3><div><p><span class="c1">Problem</span>: Tree views are difficult to support MSAA in, because the nodes may be constantly changing or lazily instantiated. The screen reader vendors actually use the SysTreeView32 class directly rather than the MSAA support for them, and can thus provide better support for native tree views.</p>

<p><span class="c1">Solution</span>: Look carefully at how Microsoft implements MSAA for its tree views. The tree view object itself handles all of the requests for get_accName for child objects. The child ID is part of the VARIANT structure's information. This means you don't really need to create a separate object for each tree view row, which saves a lot of work. Also, rather than have multiple nested level of objects, treat all of the rows as direct children of the main tree view object. Put the level, i.e. "1", "2", 3", etc. in the value field.</p></div><h3 id="msaa_implementation_is_not_performant"><a href="#msaa_implementation_is_not_performant" title="Permalink to MSAA Implementation is Not Performant">MSAA Implementation is Not Performant</a></h3><div><p><span class="c1">Problem</span>: The assistive technology may interact slowly with your application.</p>

<p><span class="c1">Solution</span>: Try not to calculate the same things more than once or create the same objects more than once. For example, create and cache an object's children when you look for them in get_accChildCount(), so that you can just hand them back when asked for using get_accChild() or accNavigate(). Support IEnumVARIANT so that the MSAA client can ask for a number of children in one call. In custom interfaces, create methods that hand back a lot of data in one call, rather than requiring a large number of calls. Fewer calls are much better because COM Marshaling is slow.</p></div><h3 id="differing_client_implementations"><a href="#differing_client_implementations" title="Permalink to Differing client implementations">Differing client implementations</a></h3><div><p><span class="c1">Problem</span>: Every assistive technology uses MSAA differently.</p>

<p><span class="c1">Solution</span>: We don't know of any outright conflicts in the differing uses of MSAA (yet). However, be on guard. If a vendors asks you to do something different from the spec, it's better to check with the other vendors before moving forward. Check to see what applications from Microsoft do in a similar situation.</p></div><h3 id="undocumented_window_class_usage"><a href="#undocumented_window_class_usage" title="Permalink to Undocumented Window Class Usage">Undocumented Window Class Usage</a></h3><div><p><span class="c1">Problem</span>: For common controls, MSAA is actually less direct than getting the window class and style bits for a window, so AT products only look for it only when necessary. In fact, when a control has its own Window, it's easy for a 3rd party application to know whether the object is disabled, focused, hidden, checked, etc.</p>

<p>Some assistive technologies will look for MSAA if it doesn't already know that the given window class is used for something common. Common examples are Button, ListBox, ComboBox, msctls_statusbar32, msctls_trackbar32, #32770 (dialog class), SysTreeView32, Static, Edit and RichEdit. Other assistive technologies use an allowlist, and must list your window classes somewhere in their implementation, and then turn on MSAA support when a window of that class receives focus. The window class is also used to determine a host of hard-coded behaviors, such as whether or not a screen reader will load the entire MSAA tree into a special buffer for the user to navigate with screen reader commands. This is only supposed to occur for document navigation, not for UI/dialogs. where your application's keyboard commands will be solely used to navigate.</p>

<p><span class="c1">Solution</span>: Contact each vendor whose product isn't using your MSAA, and let them know what window classes you will be using MSAA for. If possible, use a different window class name for documents/content than you use for UI/dialogs. Or, do what Mozilla does - expose a control ID (GWL_ID) of 1 for content, and 0 for UI. Consistent window class names are important for the assistive technology vendors, so that they can determine what code to run for a given window. Don't change window class names after you have shipped a version.</p></div><h3 id="windowfromaccessibleobject_depends_on_client-window_relationship"><a href="#windowfromaccessibleobject_depends_on_client-window_relationship" title="Permalink to WindowFromAccessibleObject depends on client-window relationship">WindowFromAccessibleObject depends on client-window relationship</a></h3><div><p><span class="c1">Problem</span>: Unless certain rules are followed, WindowFromAccessibleObject will break, causing the failure of accessibility testing tools like accexplore.exe, and assistive technologies which require knowledge of the window class to know what app-specific configurations to run. WindowFromAccessibleObject works by walking up the parent chain until it finds an object of ROLE_WINDOW. If it can't find one, it fails.</p>

<p><span class="c1">Solution</span>: Allow Microsoft Windows to handle WM_GETOBJECT messages for OBJID_WINDOW. For OBJID_CLIENT, the accessible parent must point to the ROLE_WINDOW object, or at least ensure that it's in the parent chain. The easiest way to do this is to OBJID_CLIENT object cache its parent's window handle and then implement its get_accParent() method to return the results of AccessibleObjectFromWindow(mParentHwnd OBJID_WINDOW, IID_IAccessible, &amp;ptr);</p></div><h3 id="not_all_msaa_objects_implemented_by_3rd_party_vendors"><a href="#not_all_msaa_objects_implemented_by_3rd_party_vendors" title="Permalink to Not all MSAA objects implemented by 3rd party vendors">Not all MSAA objects implemented by 3rd party vendors</a></h3><div><p><span class="c1">Problem</span>: As described above, screen readers tend to look first for window classes they know, such as Button, ListBox, ComboBox, msctls_statusbar32, msctls_trackbar32, #32770 (dialog class), SysTreeView32, Static, Edit and RichEdit. AT vendors have typically spent the most time making windows with these classes work, so they are fully debugged. In addition, the user comes to expect appropriate behavior for status bars, dialog boxes and tree views based on the fact that most apps use the standard control. Unfortunately, the MSAA implementation often lags. For example, tree views will probably not be accessible with most assistive technologies even if you have a perfect MSAA implementation. Automatic screen reading of dialog boxes and status bars will often not work just because you're using the wrong class name, even if your MSAA implementation is perfect, and everything else about the objects is completely normal.</p>

<p><span class="c1">Solution</span>: There are three things you can do: 1) try to use the standard class names, 2) pressure the screen reader vendor to fix their MSAA implementation or use better heuristics, and 3) get around the problem with 3rd party scripts for those AT's that can use them.</p></div><h3 id="not_all_msaa_features_utilized_by_3rd_party_vendors"><a href="#not_all_msaa_features_utilized_by_3rd_party_vendors" title="Permalink to Not all MSAA features utilized by 3rd party vendors">Not all MSAA features utilized by 3rd party vendors</a></h3><div><p><span class="c1">Problem</span>: The assistive technology does not use 50% of what's available in MSAA, e.g. MSAA caret, a lot of events, roles, states and methods. It's difficult to know which things to support.</p>

<p><span class="c1">Solution</span>: Use this document to see what is generally considered important by assistive technology manufacturers. Contact the top vendors early and often as you plan and implement your architecture, to see what's important to them. Implement only what's needed -- supporting everything would take too long for zero results.</p></div><h3 id="vendor_quirks"><a href="#vendor_quirks" title="Permalink to Vendor quirks">Vendor quirks</a></h3><div><p><span class="c1">Problem</span>: Because assistive technology tends to utilize MSAA as an additional solution resting on top of old hacks, rather than a completely clean and separate way to deal with an application, and because of the quirky nature of MSAA and of the inflexible heuristics that screen readers use, we do not have a "plug and play solution". In addition, assistive technology vendors are tiny companies, often scrambling to keep up with changes in the applications they already support, or new products other than yours which they need to support. It's very difficult to get vendors to spend time testing an MSAA implementation, send feedback or help find out why things aren't working. Time and version commitments often fall through. There is always a belated new version due around corner, after which you will be promised to be the next priority.</p>

<p><span class="c1">Solution</span>: Try to reach out in a friendly manner to the assistive technology company. Be as easy to work with as you possibly can -- this includes being extremely responsive to their bug reports with new test builds, as well as being very communicative about what you have changed and when. Do as much work as you possibly can without their help. See if your organization can offer something they can't get for themselves. Be patient, and set your expectations to a reasonable level. Realize that it's about both pride and revenue for these companies, and that they need to sell a lot of copies of their software to make up the work they put in to support your app. Remember that no matter how small they are, you need them more than they need you, unless your application's accessibility is being demanded by end-users.</p></div><h2 id="example_how_gecko_and_mozilla_implement_msaa"><a href="#example_how_gecko_and_mozilla_implement_msaa" title="Permalink to Example: How Gecko and Mozilla Implement MSAA">Example: How Gecko and Mozilla Implement MSAA</a></h2><div><p>The <a href="http://lxr.mozilla.org/seamonkey/source/accessible/" class="external" rel=" noopener">Accessible module</a> is where the Mozilla MSAA implementation lives. Feel free to <a href="http://lxr.mozilla.org/seamonkey/source/accessible/" class="external" rel=" noopener">peruse the source code in the accessible module</a> whenever you want to see how something can be implemented.</p>

<p>The accessible module is also where support for Sun's <a href="http://wwws.sun.com/software/star/gnome/accessibility/architecture.html" class="external" rel=" noopener">ATK</a> accessibility API for Linux and UNIX is implemented. For documentation specific to the Mozilla ATK effort, supported by Sun Microsystems, see the <a href="../../projects/ui/accessibility/unix">Mozilla accessibility on Unix</a> page.</p></div><h3 id="creation_of_iaccessible_objects"><a href="#creation_of_iaccessible_objects" title="Permalink to Creation of IAccessible Objects">Creation of IAccessible Objects</a></h3><div><p>The first thing that happens when an assistive technology wants to watch our application is that calls the Windows API function AccessibleObjectFromWindow(). This usually happens right after a window gets focused.</p>

<p>When the WIN32 API function AccessibleObjectFromWindow() is called, Windows sends the window in question a <a href="http://lxr.mozilla.org/seamonkey/search?string=WM_GETOBJECT" class="external" rel=" noopener">WM_GETOBJECT</a> message requesting an IAccessible for your root object in the window. In our case, this event is received in <a href="http://lxr.mozilla.org/seamonkey/source/widget/src/windows/nsWindow.cpp#4370" class="external" rel=" noopener"> mozilla/widget/src/windows/nsWindow.cpp</a>. We send back an IAccessible pointer which can be used by the client to get information about this root object. The assistive technology will use that root IAccessible to traverse the rest of the object tree, by navigating to children and then siblings, etc. Every navigation function such as accNavigate(), get_accChild() and get_accParent() returns an IAccessible pointer.</p>

<p>To create the root IAccessible for a window the first time it gets the <a href="http://lxr.mozilla.org/seamonkey/search?string=WM_GETOBJECT" class="external" rel=" noopener">WM_GETOBJECT</a> message in, nsWindow.cpp first generates an internal event called <a href="http://lxr.mozilla.org/seamonkey/search?string=NS_GETACCESSIBLE" class="external" rel=" noopener">NS_GETACCESSIBLE</a>, which is handled in <a href="http://lxr.mozilla.org/seamonkey/source/layout/html/base/src/nsPresShell.cpp#6345" class="external" rel=" noopener"> PresShell::HandleEventInternal()</a> via the creation of an <a href="http://lxr.mozilla.org/seamonkey/find?string=msaa/nsDocAccessibleWrap" class="external" rel=" noopener">nsDocAccessibleWrap</a> for an inner window or <a href="http://lxr.mozilla.org/seamonkey/find?string=msaa/nsRootAccessibleWrap" class="external" rel=" noopener">nsRootAccessibleWrap</a> for a top level window. These classes implement both nsIAccessible, our cross platform API, as well as IAccessible, which is specific to Windows/MSAA/COM. The cross-platform nsDocAccessible and nsRootAccessible classes they inherit from are then told to start listening for DOM, page load and scroll events. These events cause MSAA-specific events, such as EVENT_OBJECT_FOCUS or EVENT_OBJECT_STATECHANGE, to fire on UI and document objects within the applicable window. We'll explain more about events later in this section.</p>

<p>Until the WM_GETOBJECT message is processed, the Gecko accessibility service is not used, and thus the accessibility.dll is not loaded, so there is almost zero overhead for accessibility API support in Mozilla or Gecko, in the general case. Once the accessibility service is created, however, Gecko loads code to create an object on demand for every UI or document object that should support IAccessible. The created objects are cached in a hash table, and shutdown when they're no longer needed. They may still exist in memory in a nonfunctional state until the assistive technology completely releases them. See the section on accessible roles to see what kinds of objects Gecko support IAccessible for.</p></div><h3 id="the_accessible_tree_vs._the_dom_tree"><a href="#the_accessible_tree_vs._the_dom_tree" title="Permalink to The Accessible Tree vs. the DOM Tree">The Accessible Tree vs. the DOM Tree</a></h3><div><p>After the root or doc accessible for a window has been created and handed back to the MSAA client, it is used to traverse the rest of the IAccessible tree using accNavigation, get_accChild and get_accParent. Any IAccessible will support those methods. We also support IEnumVARIANT::Next() which allows for fast marshaling of all of an objects children to a client via COM. In other words, the assistive technology can say "give me all 20 children of this object into this array". That's much faster than 20 separate calls, one for each child.</p>

<p>In Mozilla, the client has another choice for tree navigation -- it can utilize data stored in the DOM via Mozilla's custom <a href="http://lxr.mozilla.org/seamonkey/source/accessible/public/msaa/ISimpleDOMNode.idl" class="external" rel=" noopener"> ISimpleDOMNode</a> COM interface. Any IAccessible can be used to QueryInterface to an ISimpleDOMNode, and vice versa for a round trip. However, one might QI ISimpleDOMNode to IAccessible only to find it is null, which means that particular node in question is not exposed in the IAccessible tree. See the following diagram for examples of nodes that do no support IAccessible.</p></div><h3 id="msaa_tree_vs._dom_tree_-_what's_the_relationship"><a href="#msaa_tree_vs._dom_tree_-_what's_the_relationship" title="Permalink to MSAA tree vs. DOM tree - what's the relationship?">MSAA tree vs. DOM tree - what's the relationship?</a></h3><div><p><img alt="" src="/en-US/docs/Web/Accessibility/Implementing_MSAA_server/tree-relativity.gif" style="border-style: solid; border-width: 1px;" width="696" height="506" loading="lazy"></p>

<p>The MSAA tree and the DOM tree are parallel structures, although the MSAA tree is a subset of the DOM tree. <code>QueryInterface()</code> can be used to switch between the interfaces used in the two trees (IAccessible and ISimpleDOMNode). If there is no MSAA node for a DOM node, pAccessible-&gt;<code>QueryInterface(IID_IAccessible)</code> will return null.</p></div><h3 id="a_variety_of_implementations_for_iaccessible"><a href="#a_variety_of_implementations_for_iaccessible" title="Permalink to A Variety of Implementations for IAccessible">A Variety of Implementations for IAccessible</a></h3><div><p>There are two main kinds of classes in Mozilla's accessibility class hierarchy, platform-specific and cross-platform. All of the platform-specific classes have the word "Wrap" appended to them. The Wrap classes contain implementations and interfaces specific to MSAA or ATK. These platform-specific classes inherit from cross-platform classes, where the most of the implementation is done. For example, nsAccessibleWrap inherits from nsAccessible. Every accessible object in the MSAA tree has an implementation derived from nsAccessible, which exposes accessibility information through nsIAccessible, in a generic cross-platform manner.</p>

<p>This default implementation for nsIAccessible knows how to use nsAccessibleTreeWalker to walk Mozilla's content DOM and frame tree, exposing only the objects that are needed for accessibility. The nsAccessibleTreeWalker class knows what it needs to expose by asking each DOM node's primary frame (a Gecko formatting object) for an nsIAccessible, using the nsIFrame::GetAccessible() method. If nsAccessibleTreeWalker gets an nsIAccessible back, then the DOM node considered to be an accessible object. The nsIAccessible that is returned is either a new one, or reused from the accessibility cache, and the correct type of accessibility object to correctly expose that DOM node through the cross-platform nsIAccessible and MSAA-specific IAccessible interfaces.</p>

<p>Every accessibility object created must be cached, and must inherit from nsAccessibleWrap so that it supports a base implementation of nsIAccessible and IAccessible. Apart from that, it is free to override IAccessible or nsIAccessible methods. In this way each class is tailored to the specific abilities and properties of the HTML or XUL/UI objects it applies to, and can support both MSAA, ATK and hopefully any future accessibility API's we need to support. For example nsHTMLButtonAccessible overrides nsIAccessible::GetAccRole to expose ROLE_BUTTON for IAccessible::get_accRole which uses that.</p>

<p>A more complicated set of nsIAccessible methods which can be overridden are GetAccFirstChild/GetAccLastChild/GetAccChildCount, which allows for objects to define their own descendant subtrees. The default behavior for nsIAccessible::getAccFirstChild is to instantiate a nsDOMTreeWalker, and ask it for the first child. However, nsImageAccessible overrides getAccFirstChild, returning the first area of an image map if there is one, otherwise nsnull. This is necessary because the image map areas can be in a completely different area of the DOM from the image they apply to.</p></div><h3 id="generating_msaa_events_2"><a href="#generating_msaa_events_2" title="Permalink to Generating MSAA Events">Generating MSAA Events</a></h3><div><p>First, keep in mind that most MSAA events aren't utilized by accessibility aids. Therefore we implement only the handful that matter. See the <a href="#events">Events</a> cheat sheet above for the list of events we implement. By far the most important one is EVENT_OBJECT_FOCUS.</p>

<p>When a potential accessibility-related event occurs within Mozilla, it is typically listened for by nsDocAccessible or nsRootAccessible. The event listeners on these classes call FireToolkitEvent(), which is implemented for every accessible. Eventually, the event ends up at nsDocAccessibleWrap::FireToolkitEvent() which calls NotifyWinEvent from the Win32 API. NotifyWinEvent is passed arguments for the window the event occurred in, and the ID of the child within that window. Accessibility aids use the Win32 call SetWinEventHook() to register as a listener for these events. Creating a unique child ID for every object within a window can be difficult, see the problem and solution for <a href="#hacky_caret_tracking_not_working">no unique child ID for object in window</a>.</p>

<p>The assistive technology chooses which events it is interested in learning more about by calling the Win32 method AccessibleObjectFromEvent, which returns the IAccessible to the node corresponding to the child number that had been indicated from NotifyWinEvent(). This ends up asking nsDocAccessibleWrap::get_accChild() for a child IAccessible which matches the child ID we indicated through NotifyWinEvent().</p>

<p>In Mozilla, we use the DOM node pointer in the accessible object as a basis for its child ID, which is also used as a hash key into our cache. We also negate the 32 bit value so that it is always &lt;0, telling us that they're really looking for the IAccessible for an event, not child number x. During the callback, we look up the original accessible node in the nsDocAccessible's cache and return it.</p></div><h2 id="feedback"><a href="#feedback" title="Permalink to Feedback">Feedback</a></h2><div><p>How can this document be improved? Was it useful? Questions? This document is maintained by the Mozilla Accessibility Community; you can reach and give us feedback on the <a href="/en-US/docs/Web/Accessibility">discussion list</a>!</p></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/style/old/files/en-us/web/accessibility/implementing_msaa_server/index.html" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/blob/style/old/files/en-us/web/accessibility/implementing_msaa_server/index.html" title="Folder: en-us/web/accessibility/implementing_msaa_server (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FImplementing_MSAA_server%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Faccessibility%2Fimplementing_msaa_server%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FImplementing_MSAA_server%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fstyle%2Fold%2Ffiles%2Fen-us%2Fweb%2Faccessibility%2Fimplementing_msaa_server%2Findex.html%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F7330517256d04c4134ae2fe57c3ae4000b33a5c2%0A*+Document+last+modified%3A+2021-10-18T01%3A33%3A24.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22Implementing+a+Microsoft+Active+Accessibility+%28MSA%E2%80%A6%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2CContent%3AAccessibility" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2021-10-18T01:33:24.000Z">Oct 18, 2021</time>,<!-- --> <a href="/en-US/docs/Web/Accessibility/Implementing_MSAA_server/contributors.txt">by MDN contributors</a></p></div></aside></main></div><footer id="nav-footer" class="page-footer"><div class="content-container"><div class="page-footer-logo"><a href="/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135" fill="#fff"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a></div><ul class="link-list-mdn"><li><a href="/en-US/docs/Web">Web Technologies</a></li><li><a href="/en-US/docs/Learn">Learn Web Development</a></li><li><a href="/en-US/docs/MDN/About">About MDN</a></li><li><a href="/en-US/docs/MDN/Feedback">Feedback</a></li></ul><ul class="link-list-moz"><li><a href="https://www.mozilla.org/about/" target="_blank" rel="noopener noreferrer">About</a></li><li><a href="https://shop.spreadshirt.com/mdn-store/" target="_blank" rel="noopener noreferrer">MDN Web Docs Store</a></li><li><a href="https://www.mozilla.org/contact/" target="_blank" rel="noopener noreferrer">Contact Us</a></li><li><a href="https://www.mozilla.org/firefox/?utm_source=developer.mozilla.org&amp;utm_campaign=footer&amp;utm_medium=referral" target="_blank" rel="noopener noreferrer">Firefox</a></li></ul><div class="social social-mdn"><h4>MDN</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="social-icon github" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Github</span></a></li></ul></div><div class="social social-moz"><h4>Mozilla</h4><ul><li><a class="social-icon twitter" href="https://twitter.com/mozilla" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Twitter</span></a></li><li><a class="social-icon instagram" href="https://www.instagram.com/mozillagram/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">Mozilla on Instagram</span></a></li></ul></div><p id="license" class="footer-license">© 2005-<!-- -->2022<!-- --> Mozilla and individual contributors. Content is available under<!-- --> <a href="/docs/MDN/About#Copyrights_and_licenses">these licenses</a>.</p><ul class="footer-legal"><li><a href="https://www.mozilla.org/about/legal/terms/mozilla" target="_blank" rel="noopener noreferrer">Terms</a></li><li><a href="https://www.mozilla.org/privacy/websites/" target="_blank" rel="noopener noreferrer">Privacy</a></li><li><a href="https://www.mozilla.org/privacy/websites/#cookies" target="_blank" rel="noopener noreferrer">Cookies</a></li></ul></div></footer><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":false,"isTranslated":false,"isActive":true,"flaws":{},"title":"Implementing a Microsoft Active Accessibility (MSAA) Server","mdn_url":"/en-US/docs/Web/Accessibility/Implementing_MSAA_server","locale":"en-US","native":"English (US)","sidebarHTML":"","body":[{"type":"prose","value":{"id":"practical_tips_for_developers_and_how_mozilla_does_it","title":"Practical Tips for Developers and How Mozilla Does It","isH3":false,"content":""}},{"type":"prose","value":{"id":"contents","title":"Contents","isH3":false,"content":"<p>This document is for developers working to support <abbr title=\"Microsoft Active Accessibility\">MSAA</abbr> in an application in order to make it accessible with 3rd party assistive technologies, as well as for hackers wishing to be involved in Mozilla's MSAA support specifically.</p>\n\n<p>If you're implementing controls/widgets, you should also see the <a href=\"../toolkit-checklist\">Accessible Toolkit Checklist</a>. If you're interested in more about Gecko's MSAA implementation, read <a href=\"at-apis\">Gecko Info for Windows Accessibility Vendors</a> to learn how MSAA clients can utilize Gecko's MSAA support.</p>"}},{"type":"prose","value":{"id":"intro_what_is_msaa","title":"Intro: What is MSAA?","isH3":false,"content":"<p>MSAA is the <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd373592.aspx\" rel=\" noopener\"> Microsoft Active Accessibility (MSAA) API</a>, used on Windows operating systems to support assistive technologies for users with disabilities.</p>\n\n<p>Third party assistive technology, such as screen readers, screen magnifiers and voice input software, want to track what's happening inside Mozilla. They need to know about focus changes and other events, and it needs to know what objects are contained in the current document or dialog box. Using this information, a screen reader will speak out loud important changes to the document or UI, and allow the user to track where they navigate. The screen reader user can navigate the web page using screen reader commands or browser commands, and the two pieces of software must remain in sync. Some screen readers can even show information on a <a class=\"ex-ref external\" href=\"http://www.deafblind.com/display.html\" rel=\" noopener\">refreshable braille display</a>. Screen magnifiers will zoom to the focus, keeping it on the screen at all times, or even allow the user to enter a special low vision document reading mode, with a variety of features such as ticker mode where text is streamed on a single line. Finally, voice dictation software needs to know what's in the current document or UI in order to implement \"say what you see\" kinds of features.</p>\n\n<p>On Microsoft Windows, these kinds of assistive technology acquire this necessary information via a combination of hacks, MSAA and proprietary DOMs. MSAA is supposed to be the \"right way\" for accessibility aids to get information, but sometimes the hacks are more effective. For example, screen readers look for screen draws of a vertical blinking line, to determine the location of the caret. Without doing this, screen readers would not be able to let the user know where there caret has moved to in most programs, because so many applications do not use the system caret (Gecko does not). This is so commonly done, that no one even bothers to support the MSAA caret, after all the hack is general solution works with pretty much all applications.</p>\n\n<p>MSAA provides information in several different ways:</p>\n\n<ol>\n <li>A COM interface (IAccessible) that allows applications to expose the tree of data nodes that make up each window in the user interface currently being interacted with and</li>\n <li>Custom interface extensions via interfaces via QueryInterface and QueryService. This can provide assistive technology with contextual information specific to your object model. For example, Gecko support ISimpleDOMNode to provide information about the DOM node for an accessible object.</li>\n <li>A set of system messages that confer accessibility-related events such as focus changes, changes to document content and state changes in UI objects like checkboxes.</li>\n</ol>\n\n<p>To really learn about MSAA, you need to download the entire <a class=\"ex-ref external\" href=\"https://www.microsoft.com/download/en/details.aspx?id=3138\" rel=\" noopener\"> MSAA SDK</a>. Without downloading the <abbr title=\"Software Development Kit\">SDK</abbr>, you won't get the extremely useful tools, which help a great deal in the learning process. The Accessible Event Watcher shows what accessible events are being generated by a given piece of software. The Accessible Explorer and Inspect Object tools show the tree of data nodes the Accessible object is exposing through COM, and what the screen boundaries of each object are. In addition, MSDN has improved their <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd373592.aspx\" rel=\" noopener\"> MSAA documentation</a>.</p>"}},{"type":"prose","value":{"id":"when_to_use_msaa_and_when_not_to","title":"When to use MSAA, and when not to","isH3":false,"content":"<p>It's a common mistake to say that MSAA is not worth using, for a number of reasons.</p>"}},{"type":"prose","value":{"id":"myths_for_not_using_msaa","title":"Myths for not using MSAA","isH3":true,"content":"<p><span class=\"c1\">Myth: MSAA doesn't really work</span><br>\n Reality: MSAA works really well for dialogs and UI. True, it's not great for documents, but it's the only existing widely-used standard for exposing accessibility.</p>\n\n<p><span class=\"c1\">Myth: MSAA is too slow</span><br>\n Reality: Assistive technology vendors have found ways around most of the performance problems related to out-of-process COM method calls. Just make sure to have decent performance on your end.</p>\n\n<p><span class=\"c1\">Myth: \"MSAA sucks\"</span><br>\n Reality: This statement may come from another engineer or even an employee of an AT vendor. And what are they recommending for an alternative, a proprietary solution? MSAA is by no means perfect, but it is the only thing that will make your custom UI elements work with most assistive technologies. Try to be careful that AT vendors do not lock you into a proprietary solution that will work with only their products.</p>\n\n<p><span class=\"c1\">Related Myth: MSAA is not supported by AT vendors</span><br>\n Reality: It's a standard, and it is supported by JAWS, Window-Eyes, ZoomText, Dragon and Supernova/HAL. There's currently nothing better.</p>\n\n<p><span class=\"c1\">Myth: MSAA has no documentation</span><br>\n Reality: You're reading useful documentation right here. The docs on <abbr title=\"Microsoft Developer Network\">MSDN</abbr> are useful as well.</p>\n\n<p><span class=\"c1\">Mostly myth: MSAA is too expensive to implement</span><br>\n Reality: *Too* expensive is relative, and depends on how important accessibility is for your project. This document's <a href=\"#cheatsheets\">Deciding Which MSAA Features to Support</a> section attempts to lower the cost by showing which parts of MSAA are not very important to work on. You only need to support MSAA on the non-standard controls in your app. So, it's not too bad.</p>\n\n<p><span class=\"c1\">Mostly myth: Microsoft is abandoning MSAA in Longhorn</span><br>\n Reality: Microsoft's accessibility strategy is changing to a new API in Longhorn. MSAA will still be supported through an emulation layer, but that will probably be a very slow solution. We'll have to wait and see how good the MSAA support in Longhorn is, before we can call this one.</p>"}},{"type":"prose","value":{"id":"msaa_decision-making_guide","title":"MSAA decision-making guide","isH3":true,"content":"<ul>\n <li><span class=\"MSAA_decision\">Use MSAA</span> whenever you have created custom controls where you're handling the drawing, mouse and keyboard accessibility in your own code. MSAA is the only way to let all AT's know what your code is doing.</li>\n</ul>\n\n<ul>\n <li><span class=\"MSAA_decision\">Don't use MSAA</span> if you're not running on a Windows platform ... hope that one was obvious.</li>\n <li><span class=\"MSAA_decision\">Don't use MSAA</span> if your only Windows target for accessibility is Longhorn.</li>\n <li><span class=\"MSAA_decision\">Don't use MSAA</span> if you're not going to take it all the way via testing with assistive technologies and working with AT vendors.</li>\n <li><span class=\"MSAA_decision\">Don't use MSAA</span> for exposing documents or other specialized data, if it's important that the user get access to formatting information. You will have to expose interfaces that contain more info than MSAA does. This information may be in the form of extensions to MSAA, like Mozilla has done with <a href=\"at-apis#externaldom\">ISimpleDOMNode</a> (you can QI to it from IAccessible). This is likely to be a painful road even if you are a major player, in terms of getting the cooperation of AT vendors. It may be a good enough solution; however, if what you need is JAWS, Dragon and ZoomText support. ZoomText and Dragon can get by with your MSAA support., and JAWS can be scripted (even by external developers) to support alternative interfaces.</li>\n <li><span class=\"MSAA_decision\">Don't use MSAA</span> if you're working with a small number of AT vendors, you can get everyone to agree on a different solution, and you're sure that you won't be needing to support other assistive technologies later.</li>\n</ul>"}},{"type":"prose","value":{"id":"deciding_which_msaa_features_to_support","title":"Deciding Which MSAA Features to Support","isH3":false,"content":""}},{"type":"prose","value":{"id":"msaa_methods_-_cheat_sheet_for_developers","title":"MSAA Methods - Cheat Sheet for Developers","isH3":true,"content":"<p>The IAccessible interface is used in a tree of IAccessible's, each one representing a data node, similar to a DOM.</p>\n\n<p>Here are the methods supported in IAccessible - a minimal implementation would contain those marked \"<strong>[important]</strong>\":</p>\n\n<ul>\n <li>get_accParent: Get the parent of an IAccessible. <strong>[important]</strong></li>\n <li>get_accChildCount: Get the number of children of an IAccessible. <strong>[important]</strong></li>\n <li>get_accChild: Get the child of an IAccessible. <strong>[important]</strong></li>\n <li>get_accName: Get the \"name\" of the IAccessible, for example the name of a button, checkbox or menu item. Try to use unique names for each item in a dialog so that voice dictation software doesn't have to deal with extra ambiguity.<strong>[important]</strong></li>\n <li>get_accValue: Get the \"value\" of the IAccessible, for example a number in a slider, a URL for a link, the text a user entered in a field. <strong>[important]</strong></li>\n <li>get_accDescription: Get a long description of the current IAccessible. This is not really too useful.</li>\n <li>get_accRole: Get an enumerated value representing what this IAccessible is used for, for example.<br>\n  is it a link, static text, editable text, a checkbox, or a table cell, etc. <strong>[important]</strong></li>\n <li>get_accState: a 32 bit field representing possible on/off states, such as focused, focusable, selected, selectable, visible, protected (for passwords), checked, etc. <strong>[important]</strong></li>\n <li>get_accHelp: Get context sensitive help for the IAccessible.</li>\n <li>get_accHelpTopic: We don't use this, it's only if the Windows help system is used.</li>\n <li>get_accKeyboardShortcut: What is the keyboard shortcut for this IAccessible (underlined alt+combo mnemonic)</li>\n <li>get_accFocus: Which child is focused? <strong>[important]</strong></li>\n <li>get_accSelection: Which children of this item are selected?</li>\n <li>get_accDefaultAction: Get a description or name of the default action for this component, such as \"jump\" for links.</li>\n <li>accSelect: Select the item associated with this IAccessible. <strong>[important]</strong></li>\n <li>accLocation: Get the x,y coordinates, and the height and width of this IAccessible node. <strong>[important]</strong></li>\n <li>accNavigate: Navigate to the first/last child, previous/next sibling, up, down, left or right from this IAccessible. <strong>[important, but no need to implement up/down/left/right]</strong></li>\n <li>accHitTest: Find out what IAccessible exists and a specific coordinate.</li>\n <li>accDoDefaultAction: Perform the action described by get_accDefaultAction.</li>\n <li>put_accName: Change the name.</li>\n <li>put_accValue: Change the value.</li>\n</ul>"}},{"type":"prose","value":{"id":"msaa_events_cheat_sheet","title":"MSAA Events Cheat Sheet","isH3":true,"content":"<p>For information on what each event does, see the <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd318066.aspx\" rel=\" noopener\"> MSDN Event Constants page</a>.</p>\n\n<p>Check with your assistive technology partners to find out what events you need to support. There's a very good chance they won't ask for more than the events marked <strong>[important]</strong>:</p>\n\n<table class=\"c5\">\n <tbody>\n  <tr>\n   <td>EVENT_SYSTEM_SOUND<br>\n    EVENT_SYSTEM_ALERT <strong>[can be important, to have auto-speaking for newly created ROLE_ALERTs]</strong><br>\n    EVENT_SYSTEM_FOREGROUND<br>\n    EVENT_SYSTEM_MENUSTART <strong>[important]</strong><br>\n    EVENT_SYSTEM_MENUEND <strong>[important]</strong><br>\n    EVENT_SYSTEM_MENUPOPUPSTART <strong>[important]</strong><br>\n    EVENT_SYSTEM_MENUPOPUPEND <strong>[important]</strong><br>\n    EVENT_SYSTEM_CAPTURESTART<br>\n    EVENT_SYSTEM_CAPTUREEND<br>\n    EVENT_SYSTEM_MOVESIZESTART<br>\n    EVENT_SYSTEM_MOVESIZEEND<br>\n    EVENT_SYSTEM_CONTEXTHELPSTART<br>\n    EVENT_SYSTEM_CONTEXTHELPEND<br>\n    EVENT_SYSTEM_DRAGDROPSTART<br>\n    EVENT_SYSTEM_DRAGDROPEND<br>\n    EVENT_SYSTEM_DIALOGSTART<br>\n    EVENT_SYSTEM_DIALOGEND<br>\n    EVENT_SYSTEM_SCROLLINGSTART<br>\n    EVENT_SYSTEM_SCROLLINGEND <strong>[possibly important, talk to AT vendor]</strong><br>\n    EVENT_SYSTEM_SWITCHSTART<br>\n    EVENT_SYSTEM_SWITCHEND<br>\n    EVENT_SYSTEM_MINIMIZESTART<br>\n    EVENT_SYSTEM_MINIMIZEEND</td>\n   <td>EVENT_OBJECT_CREATE <strong>[don't implement, watching system generated versions of this event causes</strong> <strong>assistive technology crashes]</strong><br>\n    EVENT_OBJECT_DESTROY <strong>[don't implement, watching system generated versions of this event causes assistive technology crashes]</strong><br>\n    EVENT_OBJECT_SHOW <strong>[can be important, depending on project]</strong><br>\n    EVENT_OBJECT_HIDE <strong>[can be important, depending on project]</strong><br>\n    EVENT_OBJECT_REORDER <strong>[important for mutating docs]</strong><br>\n    EVENT_OBJECT_FOCUS <strong>[important]</strong><br>\n    EVENT_OBJECT_SELECTION <strong>[important]</strong><br>\n    EVENT_OBJECT_SELECTIONADD <strong>[important for multiple selection]</strong><br>\n    EVENT_OBJECT_SELECTIONREMOVE <strong>[important for multiple selection]</strong><br>\n    EVENT_OBJECT_SELECTIONWITHIN <strong>[important for multiple selection]</strong><br>\n    EVENT_OBJECT_STATECHANGE <strong>[important for checkboxes and radio buttons]</strong><br>\n    EVENT_OBJECT_LOCATIONCHANGE<br>\n    EVENT_OBJECT_NAMECHANGE<br>\n    EVENT_OBJECT_DESCRIPTIONCHANGE<br>\n    EVENT_OBJECT_VALUECHANGE <strong>[important for sliders and progress meters]</strong><br>\n    EVENT_OBJECT_PARENTCHANGE<br>\n    EVENT_OBJECT_HELPCHANGE<br>\n    EVENT_OBJECT_DEFACTIONCHANGE<br>\n    EVENT_OBJECT_ACCELERATORCHANGE</td>\n  </tr>\n </tbody>\n</table>"}},{"type":"prose","value":{"id":"msaa_states_cheat_sheet","title":"MSAA States Cheat Sheet","isH3":true,"content":"<p>For information on what each state does, see the <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd373609.aspx\" rel=\" noopener\"> MSDN State Constants page</a>.</p>\n\n<p>Check with your assistive technology partners to find out what states you need to support. There's a very good chance they won't ask for more than the states marked <strong>[important]</strong>:</p>\n\n<table class=\"c5\">\n <tbody>\n  <tr>\n   <td>STATE_UNAVAILABLE <strong>[important]</strong><br>\n    STATE_SELECTED <strong>[important]</strong><br>\n    STATE_FOCUSED <strong>[important]</strong><br>\n    STATE_PRESSED<br>\n    STATE_CHECKED <strong>[important]</strong><br>\n    STATE_MIXED<br>\n    STATE_READONLY <strong>[important]</strong><br>\n    STATE_HOTTRACKED<br>\n    STATE_DEFAULT <strong>[important]</strong><br>\n    STATE_EXPANDED <strong>[important]</strong><br>\n    STATE_COLLAPSED <strong>[important]</strong><br>\n    STATE_BUSY <strong>[important]</strong><br>\n    STATE_FLOATING<br>\n    STATE_MARQUEED<br>\n    STATE_ANIMATED<br>\n    STATE_INVISIBLE</td>\n   <td>STATE_OFFSCREEN <strong>[important]</strong><br>\n    STATE_SIZEABLE<br>\n    STATE_MOVEABLE<br>\n    STATE_SELFVOICING<br>\n    STATE_FOCUSABLE <strong>[important]</strong><br>\n    STATE_SELECTABLE <strong>[important]</strong><br>\n    STATE_LINKED <strong>[important]</strong><br>\n    STATE_TRAVERSED <strong>[important]</strong><br>\n    STATE_MULTISELECTABLE <strong>[important]</strong><br>\n    STATE_EXTSELECTABLE<br>\n    STATE_ALERT_LOW<br>\n    STATE_ALERT_MEDIUM<br>\n    STATE_ALERT_HIGH<br>\n    STATE_PROTECTED <strong>[important]</strong><br>\n    STATE_HASPOPUP</td>\n  </tr>\n </tbody>\n</table>"}},{"type":"prose","value":{"id":"msaa_roles_cheat_sheet","title":"MSAA Roles Cheat Sheet","isH3":true,"content":"<p>For information on what each role does, see the <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd373608.aspx\" rel=\" noopener\"> MSDN Role Constants page</a>.</p>\n\n<p>Check with your assistive technology partners to find out what roles you need to support. There's a very good chance they won't ask for more than the roles marked <strong>[important]</strong>:<br>\n There is no need to support the objects marked <strong>[inserted by system].</strong> Windows will add those objects to your hierarchy for you.</p>\n\n<table class=\"c5\">\n <tbody>\n  <tr>\n   <td>ROLE_TITLEBAR <strong>[inserted by system]</strong><br>\n    ROLE_MENUBAR <strong>[important if you don't use native menus]</strong><br>\n    ROLE_SCROLLBAR<br>\n    ROLE_GRIP<br>\n    ROLE_SOUND<br>\n    ROLE_CURSOR<br>\n    ROLE_CARET<br>\n    ROLE_ALERT<br>\n    ROLE_WINDOW <strong>[inserted by system]</strong><br>\n    ROLE_CLIENT <strong>[important]</strong><br>\n    ROLE_MENUPOPUP <strong>[important]</strong><br>\n    ROLE_MENUITEM <strong>[important]</strong><br>\n    ROLE_TOOLTIP<br>\n    ROLE_APPLICATION<br>\n    ROLE_DOCUMENT<br>\n    ROLE_PANE <strong>[important]</strong><br>\n    ROLE_CHART<br>\n    ROLE_DIALOG <strong>[semi-important, not currently used by all AT's]</strong><br>\n    ROLE_BORDER<br>\n    ROLE_GROUPING<br>\n    ROLE_SEPARATOR <strong>[important]</strong><br>\n    ROLE_TOOLBAR<br>\n    ROLE_STATUSBAR <strong>[important]</strong><br>\n    ROLE_TABLE <strong>[important]</strong><br>\n    ROLE_COLUMNHEADER<br>\n    ROLE_ROWHEADER<br>\n    ROLE_COLUMN<br>\n    ROLE_ROW<br>\n    ROLE_CELL <strong>[important]</strong><br>\n    ROLE_LINK <strong>[important]</strong><br>\n    ROLE_HELPBALLOON<br>\n    ROLE_CHARACTER</td>\n   <td>ROLE_LIST <strong>[important]</strong><br>\n    ROLE_LISTITEM <strong>[important]</strong><br>\n    ROLE_OUTLINE <strong>[important]</strong><br>\n    ROLE_OUTLINEITEM <strong>[important]</strong><br>\n    ROLE_PAGETAB <strong>[important]</strong><br>\n    ROLE_PROPERTYPAGE <strong>[important]</strong><br>\n    ROLE_INDICATOR<br>\n    ROLE_GRAPHIC <strong>[important]</strong><br>\n    ROLE_STATICTEXT <strong>[important]</strong><br>\n    ROLE_TEXT <strong>[important]</strong><br>\n    ROLE_PUSHBUTTON <strong>[important]</strong><br>\n    ROLE_CHECKBUTTON <strong>[important]</strong><br>\n    ROLE_RADIOBUTTON <strong>[important]</strong><br>\n    ROLE_COMBOBOX <strong>[important]</strong><br>\n    ROLE_DROPLIST <strong>[important]</strong><br>\n    ROLE_PROGRESSBAR <strong>[important]</strong><br>\n    ROLE_DIAL<br>\n    ROLE_HOTKEYFIELD<br>\n    ROLE_SLIDER<br>\n    ROLE_SPINBUTTON<br>\n    ROLE_DIAGRAM<br>\n    ROLE_ANIMATION<br>\n    ROLE_EQUATION<br>\n    ROLE_BUTTONDROPDOWN<br>\n    ROLE_BUTTONMENU<br>\n    ROLE_BUTTONDROPDOWNGRID<br>\n    ROLE_WHITESPACE<br>\n    ROLE_PAGETABLIST <strong>[important]</strong><br>\n    ROLE_CLOCK<br>\n    ROLE_SPLITBUTTON<br>\n    ROLE_IPADDRESS<br>\n    ROLE_NOTHING</td>\n  </tr>\n </tbody>\n</table>"}},{"type":"prose","value":{"id":"msaa_object_identifiers_cheat_sheet","title":"MSAA Object Identifiers Cheat Sheet","isH3":true,"content":"<p class=\"note\">For information on what each object identifier does, see the <a class=\"ex-ref external\" href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd373606.aspx\" rel=\" noopener\"> MSDN Object Identifiers Constants page</a>.</p>\n\n<p>Check with our assistive technology partners to find out what object identifiers you need to support. There's a very good chance they won't ask for more than the object identifiers marked <strong>[important]</strong>:</p>\n\n<dl>\n <dt id=\"objid_alert_objid_caret_objid_client\">OBJID_ALERT, OBJID_CARET, OBJID_CLIENT</dt>\n <dd>[important]</dd>\n <dt id=\"objid_cursor_objid_hscroll_objid_nativeom\">OBJID_CURSOR, OBJID_HSCROLL, OBJID_NATIVEOM</dt>\n <dd>[important? might be useful for supporting custom interfaces, need to research]</dd>\n <dt id=\"objid_menu_objid_queryclassnameidx_objid_sizegrip_objid_sound_objid_sysmenu_objid_titlebar_objid_vscroll_objid_window\">OBJID_MENU, OBJID_QUERYCLASSNAMEIDX, OBJID_SIZEGRIP, OBJID_SOUND, OBJID_SYSMENU, OBJID_TITLEBAR, OBJID_VSCROLL, OBJID_WINDOW</dt>\n <dd>[important, but implemented automatically by Microsoft Windows. Will return object of type ROLE_WINDOW. See <a href=\"#windowfromaccessibleobject\">WindowFromAccessibleObject quirk explanation</a> below.]</dd>\n</dl>"}},{"type":"prose","value":{"id":"dealing_with_the_quirks_of_msaa","title":"Dealing with the Quirks of MSAA","isH3":false,"content":"<p>MSAA has a well deserved reputation for quirkiness. It is not \"plug and play\", and will take a lot of testing/refinement before your solution works with any product. Here are some of its quirks and some solutions/workarounds:</p>"}},{"type":"prose","value":{"id":"msaa_can_be_crash_prone","title":"MSAA can be crash prone","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Many of MSAA's crash occur because more than one process is refcounting the same objects, and because pointers are being shared between processes. When your application closes, different signals are typically broadcast. For example, the application window closes and the window is blurred. It is impossible to know if and when the 3rd party assistive technology will use one of these signals to release the objects of yours that it is refcounting. This can lead to crashes where it releases something and the wrong time, when some of your dll's are unloaded but not others, and a destructor is called in an unloaded DLL.</p>\n\n<p><span class=\"c1\">Solution</span>: Create a \"shutdown\" method for each internal accessible object, to remove any references to other internal objects before any of your dll's are unloaded. In order to do this effectively, you will have to keep track of every accessible object that you create. The shutdown method for an accessibility object should be called whenever the document or UI object it refers to goes away. The easiest way to do that is to keep a pointer to an accessible in each internal UI object. If that pointer is non-null, then there is an accessible object for it. Whenever the UI object is destroyed, shutdown it's accessible object as well. In Gecko/Mozilla we are not allowed to keep this extra pointer for each accessible object, so when accessibility is turned on we use a hash table to cache these objects. Such a cache must be kept in perfect sync with the tree of UI and document objects, which is difficult. Therefore, unless 4 bytes extra on each object is critical in your application, just keep the extra pointer around instead of using a hash table.</p>\n\n<p>Also, don't implement EVENT_OBJECT_CREATE or EVENT_OBJECT_DESTROY. Vendors have found that watching these events causes crashes.</p>"}},{"type":"prose","value":{"id":"hacky_caret_tracking_causes_problems","title":"Hacky caret tracking causes problems","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Assistive technologies do not use the MSAA caret. They follow screen draws, looking for a vertical blinking line. Unfortunately, some products can get confused by the vertical lines on other objects, such as list boxes, even though those lines are not blinking. The assistive technology may not see your caret at all.</p>\n\n<p><span class=\"c1\">Solution</span>: Make sure there is a configuration file for each assistive technology specific to your application. Read the manual or help, and find the keystroke or commands for training the caret, and save this information in the configuration file. Make sure the caret always has the same width (1px or 2px) within a given window class. Don't support the MSAA caret unless you need Home Page Reader's desktop reader application to work with your application -- no one else uses the MSAA caret.</p>"}},{"type":"prose","value":{"id":"hacky_highlight_tracking_causes_problems","title":"Hacky highlight tracking causes problems","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Screen readers ignore the MSAA focus whenever a highlight bar moves, speaking the current highlighted text instead. The implementation of automated highlight tracking reads any text that is currently highlighted, even if it resides in several places on the screen. It does not take into account the problems that commonly occur with this feature, such as speaking the wrong thing, speaking the right thing twice or speaking two different things. Problems can easily happen merely by having two listboxes visible at the same time, because selected listbox items use the system highlight color, even when the listbox itself is not focused. Other problems occur when a piece of static text which has the same color background, which will cause that text to be repeated each time the focus or highlight moves. At least one major screen reader has a feature to turn highlight tracking off, but that's only a global setting, and turning off highlight tracking globally also turns off the speaking of menu items.</p>\n\n<p><span class=\"c1\">Solution</span>: Don't use the system highlight color for items that you don't want spoken when the highlight or focus moves. To fix this for standard listboxes, use owner drawn list items, so that you can change the highlight color when an item doesn't have focus. For listboxes that are not focused, use a different highlight color, to give the appearance that the listbox is no longer focused -- a lighter color for unfocused lists will also make the listbox state more visually obvious and thus more usable for everyone. For popup listboxes used for dropdowns in autocomplete text fields, change the color value by 1 when the user is typing in the textfield as opposed to arrowing through the list. The listbox will still visually appear to be active, but the screen reader behavior is improved by not echoing too much spoken information for each keypress. One downside to this solution is that means that you cannot use \"client data\" for the list items, because Windows won't allow owner drawn list items to use client data.</p>"}},{"type":"prose","value":{"id":"event_window_handle_is_incorrect","title":"Event window handle is incorrect","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: The screen reader or other assistive technology does not track the focus or other events correctly.</p>\n\n<p><span class=\"c1\">Solution</span>: This may be because you are reporting that the events in a different window from the current system focus. The assistive technology may be asking GetGUIThreadInfo for its hwndFocus, and throwing away MSAA events that are not in the currently focused window. Even if you are visibly showing window focus on the correct window, you must also tell the operating system to focus this window before any other accessibility events get fired in it.</p>"}},{"type":"prose","value":{"id":"confusion_with_system-generated_events","title":"Confusion with system-generated events","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: When you test with Accessible Event Watcher in the MSAA SDK, you will see many events that your application did not generate. Microsoft Windows generates some events for you. These can be problematic, because the assistive technology has no way to tell whether the event came from your application or from Windows. For example, when you set window focus, Windows will generate an EVENT_OBJECT_FOCUS event and a ROLE_WINDOW object it also generated for you. If you happen to set window focus after you fired your own EVENT_OBJECT_FOCUS event on an object in the window, your event will be ignored, because assistive technology software tends to pay attention only to the last focus event.</p>\n\n<p><span class=\"c1\">Solution</span>: When an object is about to get focused in a different window, make sure you focus a window before you fire your own focus events for objects inside it. Test using Accessible Event Watcher in the MSAA SDK, and use the settings panel to watch subsets of accessibility events. Count on the assistive technology to make sense out the jumble of extra system-generated events, it's not your problem.</p>"}},{"type":"prose","value":{"id":"no_unique_child_id_for_event_target_in_window","title":"No unique child ID for event target in window","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: MSAA expects events to be reported using NotifyWinEvent(eventNum, hWnd, worldID, childID), and there may not be an obvious way to get a window handle and a 32 bit childID for an object. You may be using windowless controls, or have an entire document with lots of objects in a given window. The child ID must be unique, because this is what the assistive technology will use to retrieve the accessible via AccessibleObjectFromEvent() which ends up using get_accChild on the accessible for the given window.</p>\n\n<p><span class=\"c1\">Solution</span>: In Gecko/Mozilla, we did not want to store an extra 32 bit unique ID value on every object. Instead, we hand back a 32 bit value derived from the UI object's pointer, which is unique. We ensure that the value we hand back is always negative. When the get_accChild call comes back, we check our hash table cache for that window to see if there's an accessible object still associated with that unique value. This means the client must use AccessibleObjectFromEvent immediately, because there is a danger that the object will go away, and another different object will be created with the same pointer value.That case seems extremely remote, because information from events is generally retrieved right after the event.</p>\n\n<p>If you're not using a hash table to keep track of unique ID's, store the child ID's and objects for the last 50 or so events in a circular array. In practice, this is enough to keep AccessibleObjectFromEvent() happy.</p>"}},{"type":"prose","value":{"id":"missing_functionality_in_msaa_2","title":"Missing functionality in MSAA","isH3":true,"content":"<p><span class=\"c1\">Problem and solutions:</span> Assistive technology vendors need some things which MSAA does not provide, such as:</p>\n\n<ul>\n <li>No way of signifying that a document has finished loading. Fire EVENT_OBJECT_STATECHANGE for a window/client/pane object when it starts to load a new document. Use STATE_BUSY to indicate that a new document is being loaded. When the loading has finished, fire another EVENT_OBJECT_STATECHANGE event and clear the STATE_BUSY flag.</li>\n <li>No method to get clipped/unclipped bounds of a piece of text within a text object. This is needed by screen magnifiers. No scrollTo method, also needed by screen magnifiers. Implement a custom interface for text objects, and support it through QueryInterface or QueryService if it's being implemented on a different object than IAccessible is. Support a scrollTo method which takes a text index, and a getClippedBounds and getUnclippedBounds method which takes a start and end index. Publish your custom interface.</li>\n <li>No way for assistive technology to know when scrolling has stopped. Fire the EVENT_SYSTEM_SCROLLINGEND event to indicate when scrolling has ended (try not to fire too many of these, wait until scrolling has truly stopped). There is no need to support EVENT_SYSTEM_SCROLLINGSTART, it is not used by assistive technology.</li>\n <li>No support for document formatting or \"DOM\" as requested by some vendors: support a custom interface that gives them the formatting information they are requesting.</li>\n</ul>"}},{"type":"prose","value":{"id":"dueling_text_equivalents","title":"Dueling text equivalents","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: There are three kinds of text equivalents, and it is difficult to know when to use each. Different applications behave differently in this regard. For example, Acrobat uses accessible value for text labels where as most programs use accessible name.</p>\n\n<p><span class=\"c1\">Solution</span>: Be as consistent with Internet Explorer as possible. Use accessible name for most text equivalents, and accessible value for URL's. Don't use accessible description unless you really do have a long description for the object you need to expose -- most assistive technology makes little use of it.</p>"}},{"type":"prose","value":{"id":"dueling_text_roles","title":"Dueling text roles","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: There are two different roles for text objects, ROLE_STATICTEXT and ROLE_TEXT. ROLE_TEXT is supposed to mean editable text, yet it is sometimes used in conjunction with STATE_READONLY. It's difficult to know when to use which role plus readonly state combination. For example, Internet Explorer uses ROLE_TEXT without STATE_READONLY and ROLE_TEXT with STATE_READONLY for ordinary web page text. However, it uses ROLE_STATICTEXT for labels.</p>\n\n<p><span class=\"c1\">Solution</span>: Use ROLE_STATICTEXT for labels specific to dialog and UI controls, and always use ROLE_TEXT for document text even if the text is not editable (in that case use ROLE_TEXT with STATE_READONLY). Use ROLE_TEXT with the readonly flag cleared for editable text fields.</p>"}},{"type":"prose","value":{"id":"issues_with_links","title":"Issues with Links","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Some assistive technologies have inflexible heuristics when it comes to reading links. They may not read the object unless the states are correctly set. Second, they can mishandle the object if it cannot parse the whitespace according to its own rules. Most assistive technologies don't know what to do with links embedded in a dialog, as it's becoming more common.</p>\n\n<p><span class=\"c1\">Solution</span>: For links inside documents, make sure the ROLE_LINK object and its child ROLE_TEXT objects all have STATE_LINKED set. For multi-line links with a line break in the middle, make sure there is no whitespace at the beginning or end of any of the accessible names, and make sure there is a \\r\\n where the line breaks occur in the accessible name for the ROLE_LINK. For an example of how to do this properly, see Internet Explorer or Gecko. Again, if it's not done exactly this way, some links will not be read.</p>\n\n<p>For links inside dialogs, just expose a single ROLE_LINK object and work on a scripting or code change solution with the assistive technology vendor.</p>"}},{"type":"prose","value":{"id":"issues_with_tree_views","title":"Issues with Tree Views","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Tree views are difficult to support MSAA in, because the nodes may be constantly changing or lazily instantiated. The screen reader vendors actually use the SysTreeView32 class directly rather than the MSAA support for them, and can thus provide better support for native tree views.</p>\n\n<p><span class=\"c1\">Solution</span>: Look carefully at how Microsoft implements MSAA for its tree views. The tree view object itself handles all of the requests for get_accName for child objects. The child ID is part of the VARIANT structure's information. This means you don't really need to create a separate object for each tree view row, which saves a lot of work. Also, rather than have multiple nested level of objects, treat all of the rows as direct children of the main tree view object. Put the level, i.e. \"1\", \"2\", 3\", etc. in the value field.</p>"}},{"type":"prose","value":{"id":"msaa_implementation_is_not_performant","title":"MSAA Implementation is Not Performant","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: The assistive technology may interact slowly with your application.</p>\n\n<p><span class=\"c1\">Solution</span>: Try not to calculate the same things more than once or create the same objects more than once. For example, create and cache an object's children when you look for them in get_accChildCount(), so that you can just hand them back when asked for using get_accChild() or accNavigate(). Support IEnumVARIANT so that the MSAA client can ask for a number of children in one call. In custom interfaces, create methods that hand back a lot of data in one call, rather than requiring a large number of calls. Fewer calls are much better because COM Marshaling is slow.</p>"}},{"type":"prose","value":{"id":"differing_client_implementations","title":"Differing client implementations","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Every assistive technology uses MSAA differently.</p>\n\n<p><span class=\"c1\">Solution</span>: We don't know of any outright conflicts in the differing uses of MSAA (yet). However, be on guard. If a vendors asks you to do something different from the spec, it's better to check with the other vendors before moving forward. Check to see what applications from Microsoft do in a similar situation.</p>"}},{"type":"prose","value":{"id":"undocumented_window_class_usage","title":"Undocumented Window Class Usage","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: For common controls, MSAA is actually less direct than getting the window class and style bits for a window, so AT products only look for it only when necessary. In fact, when a control has its own Window, it's easy for a 3rd party application to know whether the object is disabled, focused, hidden, checked, etc.</p>\n\n<p>Some assistive technologies will look for MSAA if it doesn't already know that the given window class is used for something common. Common examples are Button, ListBox, ComboBox, msctls_statusbar32, msctls_trackbar32, #32770 (dialog class), SysTreeView32, Static, Edit and RichEdit. Other assistive technologies use an allowlist, and must list your window classes somewhere in their implementation, and then turn on MSAA support when a window of that class receives focus. The window class is also used to determine a host of hard-coded behaviors, such as whether or not a screen reader will load the entire MSAA tree into a special buffer for the user to navigate with screen reader commands. This is only supposed to occur for document navigation, not for UI/dialogs. where your application's keyboard commands will be solely used to navigate.</p>\n\n<p><span class=\"c1\">Solution</span>: Contact each vendor whose product isn't using your MSAA, and let them know what window classes you will be using MSAA for. If possible, use a different window class name for documents/content than you use for UI/dialogs. Or, do what Mozilla does - expose a control ID (GWL_ID) of 1 for content, and 0 for UI. Consistent window class names are important for the assistive technology vendors, so that they can determine what code to run for a given window. Don't change window class names after you have shipped a version.</p>"}},{"type":"prose","value":{"id":"windowfromaccessibleobject_depends_on_client-window_relationship","title":"WindowFromAccessibleObject depends on client-window relationship","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Unless certain rules are followed, WindowFromAccessibleObject will break, causing the failure of accessibility testing tools like accexplore.exe, and assistive technologies which require knowledge of the window class to know what app-specific configurations to run. WindowFromAccessibleObject works by walking up the parent chain until it finds an object of ROLE_WINDOW. If it can't find one, it fails.</p>\n\n<p><span class=\"c1\">Solution</span>: Allow Microsoft Windows to handle WM_GETOBJECT messages for OBJID_WINDOW. For OBJID_CLIENT, the accessible parent must point to the ROLE_WINDOW object, or at least ensure that it's in the parent chain. The easiest way to do this is to OBJID_CLIENT object cache its parent's window handle and then implement its get_accParent() method to return the results of AccessibleObjectFromWindow(mParentHwnd OBJID_WINDOW, IID_IAccessible, &amp;ptr);</p>"}},{"type":"prose","value":{"id":"not_all_msaa_objects_implemented_by_3rd_party_vendors","title":"Not all MSAA objects implemented by 3rd party vendors","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: As described above, screen readers tend to look first for window classes they know, such as Button, ListBox, ComboBox, msctls_statusbar32, msctls_trackbar32, #32770 (dialog class), SysTreeView32, Static, Edit and RichEdit. AT vendors have typically spent the most time making windows with these classes work, so they are fully debugged. In addition, the user comes to expect appropriate behavior for status bars, dialog boxes and tree views based on the fact that most apps use the standard control. Unfortunately, the MSAA implementation often lags. For example, tree views will probably not be accessible with most assistive technologies even if you have a perfect MSAA implementation. Automatic screen reading of dialog boxes and status bars will often not work just because you're using the wrong class name, even if your MSAA implementation is perfect, and everything else about the objects is completely normal.</p>\n\n<p><span class=\"c1\">Solution</span>: There are three things you can do: 1) try to use the standard class names, 2) pressure the screen reader vendor to fix their MSAA implementation or use better heuristics, and 3) get around the problem with 3rd party scripts for those AT's that can use them.</p>"}},{"type":"prose","value":{"id":"not_all_msaa_features_utilized_by_3rd_party_vendors","title":"Not all MSAA features utilized by 3rd party vendors","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: The assistive technology does not use 50% of what's available in MSAA, e.g. MSAA caret, a lot of events, roles, states and methods. It's difficult to know which things to support.</p>\n\n<p><span class=\"c1\">Solution</span>: Use this document to see what is generally considered important by assistive technology manufacturers. Contact the top vendors early and often as you plan and implement your architecture, to see what's important to them. Implement only what's needed -- supporting everything would take too long for zero results.</p>"}},{"type":"prose","value":{"id":"vendor_quirks","title":"Vendor quirks","isH3":true,"content":"<p><span class=\"c1\">Problem</span>: Because assistive technology tends to utilize MSAA as an additional solution resting on top of old hacks, rather than a completely clean and separate way to deal with an application, and because of the quirky nature of MSAA and of the inflexible heuristics that screen readers use, we do not have a \"plug and play solution\". In addition, assistive technology vendors are tiny companies, often scrambling to keep up with changes in the applications they already support, or new products other than yours which they need to support. It's very difficult to get vendors to spend time testing an MSAA implementation, send feedback or help find out why things aren't working. Time and version commitments often fall through. There is always a belated new version due around corner, after which you will be promised to be the next priority.</p>\n\n<p><span class=\"c1\">Solution</span>: Try to reach out in a friendly manner to the assistive technology company. Be as easy to work with as you possibly can -- this includes being extremely responsive to their bug reports with new test builds, as well as being very communicative about what you have changed and when. Do as much work as you possibly can without their help. See if your organization can offer something they can't get for themselves. Be patient, and set your expectations to a reasonable level. Realize that it's about both pride and revenue for these companies, and that they need to sell a lot of copies of their software to make up the work they put in to support your app. Remember that no matter how small they are, you need them more than they need you, unless your application's accessibility is being demanded by end-users.</p>"}},{"type":"prose","value":{"id":"example_how_gecko_and_mozilla_implement_msaa","title":"Example: How Gecko and Mozilla Implement MSAA","isH3":false,"content":"<p>The <a href=\"http://lxr.mozilla.org/seamonkey/source/accessible/\" class=\"external\" rel=\" noopener\">Accessible module</a> is where the Mozilla MSAA implementation lives. Feel free to <a href=\"http://lxr.mozilla.org/seamonkey/source/accessible/\" class=\"external\" rel=\" noopener\">peruse the source code in the accessible module</a> whenever you want to see how something can be implemented.</p>\n\n<p>The accessible module is also where support for Sun's <a href=\"http://wwws.sun.com/software/star/gnome/accessibility/architecture.html\" class=\"external\" rel=\" noopener\">ATK</a> accessibility API for Linux and UNIX is implemented. For documentation specific to the Mozilla ATK effort, supported by Sun Microsystems, see the <a href=\"../../projects/ui/accessibility/unix\">Mozilla accessibility on Unix</a> page.</p>"}},{"type":"prose","value":{"id":"creation_of_iaccessible_objects","title":"Creation of IAccessible Objects","isH3":true,"content":"<p>The first thing that happens when an assistive technology wants to watch our application is that calls the Windows API function AccessibleObjectFromWindow(). This usually happens right after a window gets focused.</p>\n\n<p>When the WIN32 API function AccessibleObjectFromWindow() is called, Windows sends the window in question a <a href=\"http://lxr.mozilla.org/seamonkey/search?string=WM_GETOBJECT\" class=\"external\" rel=\" noopener\">WM_GETOBJECT</a> message requesting an IAccessible for your root object in the window. In our case, this event is received in <a href=\"http://lxr.mozilla.org/seamonkey/source/widget/src/windows/nsWindow.cpp#4370\" class=\"external\" rel=\" noopener\"> mozilla/widget/src/windows/nsWindow.cpp</a>. We send back an IAccessible pointer which can be used by the client to get information about this root object. The assistive technology will use that root IAccessible to traverse the rest of the object tree, by navigating to children and then siblings, etc. Every navigation function such as accNavigate(), get_accChild() and get_accParent() returns an IAccessible pointer.</p>\n\n<p>To create the root IAccessible for a window the first time it gets the <a href=\"http://lxr.mozilla.org/seamonkey/search?string=WM_GETOBJECT\" class=\"external\" rel=\" noopener\">WM_GETOBJECT</a> message in, nsWindow.cpp first generates an internal event called <a href=\"http://lxr.mozilla.org/seamonkey/search?string=NS_GETACCESSIBLE\" class=\"external\" rel=\" noopener\">NS_GETACCESSIBLE</a>, which is handled in <a href=\"http://lxr.mozilla.org/seamonkey/source/layout/html/base/src/nsPresShell.cpp#6345\" class=\"external\" rel=\" noopener\"> PresShell::HandleEventInternal()</a> via the creation of an <a href=\"http://lxr.mozilla.org/seamonkey/find?string=msaa/nsDocAccessibleWrap\" class=\"external\" rel=\" noopener\">nsDocAccessibleWrap</a> for an inner window or <a href=\"http://lxr.mozilla.org/seamonkey/find?string=msaa/nsRootAccessibleWrap\" class=\"external\" rel=\" noopener\">nsRootAccessibleWrap</a> for a top level window. These classes implement both nsIAccessible, our cross platform API, as well as IAccessible, which is specific to Windows/MSAA/COM. The cross-platform nsDocAccessible and nsRootAccessible classes they inherit from are then told to start listening for DOM, page load and scroll events. These events cause MSAA-specific events, such as EVENT_OBJECT_FOCUS or EVENT_OBJECT_STATECHANGE, to fire on UI and document objects within the applicable window. We'll explain more about events later in this section.</p>\n\n<p>Until the WM_GETOBJECT message is processed, the Gecko accessibility service is not used, and thus the accessibility.dll is not loaded, so there is almost zero overhead for accessibility API support in Mozilla or Gecko, in the general case. Once the accessibility service is created, however, Gecko loads code to create an object on demand for every UI or document object that should support IAccessible. The created objects are cached in a hash table, and shutdown when they're no longer needed. They may still exist in memory in a nonfunctional state until the assistive technology completely releases them. See the section on accessible roles to see what kinds of objects Gecko support IAccessible for.</p>"}},{"type":"prose","value":{"id":"the_accessible_tree_vs._the_dom_tree","title":"The Accessible Tree vs. the DOM Tree","isH3":true,"content":"<p>After the root or doc accessible for a window has been created and handed back to the MSAA client, it is used to traverse the rest of the IAccessible tree using accNavigation, get_accChild and get_accParent. Any IAccessible will support those methods. We also support IEnumVARIANT::Next() which allows for fast marshaling of all of an objects children to a client via COM. In other words, the assistive technology can say \"give me all 20 children of this object into this array\". That's much faster than 20 separate calls, one for each child.</p>\n\n<p>In Mozilla, the client has another choice for tree navigation -- it can utilize data stored in the DOM via Mozilla's custom <a href=\"http://lxr.mozilla.org/seamonkey/source/accessible/public/msaa/ISimpleDOMNode.idl\" class=\"external\" rel=\" noopener\"> ISimpleDOMNode</a> COM interface. Any IAccessible can be used to QueryInterface to an ISimpleDOMNode, and vice versa for a round trip. However, one might QI ISimpleDOMNode to IAccessible only to find it is null, which means that particular node in question is not exposed in the IAccessible tree. See the following diagram for examples of nodes that do no support IAccessible.</p>"}},{"type":"prose","value":{"id":"msaa_tree_vs._dom_tree_-_what's_the_relationship","title":"MSAA tree vs. DOM tree - what's the relationship?","isH3":true,"content":"<p><img alt=\"\" src=\"/en-US/docs/Web/Accessibility/Implementing_MSAA_server/tree-relativity.gif\" style=\"border-style: solid; border-width: 1px;\" width=\"696\" height=\"506\" loading=\"lazy\"></p>\n\n<p>The MSAA tree and the DOM tree are parallel structures, although the MSAA tree is a subset of the DOM tree. <code>QueryInterface()</code> can be used to switch between the interfaces used in the two trees (IAccessible and ISimpleDOMNode). If there is no MSAA node for a DOM node, pAccessible-&gt;<code>QueryInterface(IID_IAccessible)</code> will return null.</p>"}},{"type":"prose","value":{"id":"a_variety_of_implementations_for_iaccessible","title":"A Variety of Implementations for IAccessible","isH3":true,"content":"<p>There are two main kinds of classes in Mozilla's accessibility class hierarchy, platform-specific and cross-platform. All of the platform-specific classes have the word \"Wrap\" appended to them. The Wrap classes contain implementations and interfaces specific to MSAA or ATK. These platform-specific classes inherit from cross-platform classes, where the most of the implementation is done. For example, nsAccessibleWrap inherits from nsAccessible. Every accessible object in the MSAA tree has an implementation derived from nsAccessible, which exposes accessibility information through nsIAccessible, in a generic cross-platform manner.</p>\n\n<p>This default implementation for nsIAccessible knows how to use nsAccessibleTreeWalker to walk Mozilla's content DOM and frame tree, exposing only the objects that are needed for accessibility. The nsAccessibleTreeWalker class knows what it needs to expose by asking each DOM node's primary frame (a Gecko formatting object) for an nsIAccessible, using the nsIFrame::GetAccessible() method. If nsAccessibleTreeWalker gets an nsIAccessible back, then the DOM node considered to be an accessible object. The nsIAccessible that is returned is either a new one, or reused from the accessibility cache, and the correct type of accessibility object to correctly expose that DOM node through the cross-platform nsIAccessible and MSAA-specific IAccessible interfaces.</p>\n\n<p>Every accessibility object created must be cached, and must inherit from nsAccessibleWrap so that it supports a base implementation of nsIAccessible and IAccessible. Apart from that, it is free to override IAccessible or nsIAccessible methods. In this way each class is tailored to the specific abilities and properties of the HTML or XUL/UI objects it applies to, and can support both MSAA, ATK and hopefully any future accessibility API's we need to support. For example nsHTMLButtonAccessible overrides nsIAccessible::GetAccRole to expose ROLE_BUTTON for IAccessible::get_accRole which uses that.</p>\n\n<p>A more complicated set of nsIAccessible methods which can be overridden are GetAccFirstChild/GetAccLastChild/GetAccChildCount, which allows for objects to define their own descendant subtrees. The default behavior for nsIAccessible::getAccFirstChild is to instantiate a nsDOMTreeWalker, and ask it for the first child. However, nsImageAccessible overrides getAccFirstChild, returning the first area of an image map if there is one, otherwise nsnull. This is necessary because the image map areas can be in a completely different area of the DOM from the image they apply to.</p>"}},{"type":"prose","value":{"id":"generating_msaa_events_2","title":"Generating MSAA Events","isH3":true,"content":"<p>First, keep in mind that most MSAA events aren't utilized by accessibility aids. Therefore we implement only the handful that matter. See the <a href=\"#events\">Events</a> cheat sheet above for the list of events we implement. By far the most important one is EVENT_OBJECT_FOCUS.</p>\n\n<p>When a potential accessibility-related event occurs within Mozilla, it is typically listened for by nsDocAccessible or nsRootAccessible. The event listeners on these classes call FireToolkitEvent(), which is implemented for every accessible. Eventually, the event ends up at nsDocAccessibleWrap::FireToolkitEvent() which calls NotifyWinEvent from the Win32 API. NotifyWinEvent is passed arguments for the window the event occurred in, and the ID of the child within that window. Accessibility aids use the Win32 call SetWinEventHook() to register as a listener for these events. Creating a unique child ID for every object within a window can be difficult, see the problem and solution for <a href=\"#hacky_caret_tracking_not_working\">no unique child ID for object in window</a>.</p>\n\n<p>The assistive technology chooses which events it is interested in learning more about by calling the Win32 method AccessibleObjectFromEvent, which returns the IAccessible to the node corresponding to the child number that had been indicated from NotifyWinEvent(). This ends up asking nsDocAccessibleWrap::get_accChild() for a child IAccessible which matches the child ID we indicated through NotifyWinEvent().</p>\n\n<p>In Mozilla, we use the DOM node pointer in the accessible object as a basis for its child ID, which is also used as a hash key into our cache. We also negate the 32 bit value so that it is always &lt;0, telling us that they're really looking for the IAccessible for an event, not child number x. During the callback, we look up the original accessible node in the nsDocAccessible's cache and return it.</p>"}},{"type":"prose","value":{"id":"feedback","title":"Feedback","isH3":false,"content":"<p>How can this document be improved? Was it useful? Questions? This document is maintained by the Mozilla Accessibility Community; you can reach and give us feedback on the <a href=\"/en-US/docs/Web/Accessibility\">discussion list</a>!</p>"}}],"toc":[{"text":"Practical Tips for Developers and How Mozilla Does It","id":"practical_tips_for_developers_and_how_mozilla_does_it"},{"text":"Contents","id":"contents"},{"text":"Intro: What is MSAA?","id":"intro_what_is_msaa"},{"text":"When to use MSAA, and when not to","id":"when_to_use_msaa_and_when_not_to"},{"text":"Deciding Which MSAA Features to Support","id":"deciding_which_msaa_features_to_support"},{"text":"Dealing with the Quirks of MSAA","id":"dealing_with_the_quirks_of_msaa"},{"text":"Example: How Gecko and Mozilla Implement MSAA","id":"example_how_gecko_and_mozilla_implement_msaa"},{"text":"Feedback","id":"feedback"}],"summary":"This document is for developers working to support MSAA in an application in order to make it accessible with 3rd party assistive technologies, as well as for hackers wishing to be involved in Mozilla's MSAA support specifically.","popularity":0,"modified":"2021-10-18T01:33:24.000Z","source":{"folder":"en-us/web/accessibility/implementing_msaa_server","github_url":"https://github.com/mdn/content/blob/style/old/files/en-us/web/accessibility/implementing_msaa_server/index.html","last_commit_url":"https://github.com/mdn/content/commit/7330517256d04c4134ae2fe57c3ae4000b33a5c2","filename":"index.html"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/Accessibility","title":"Accessibility"},{"uri":"/en-US/docs/Web/Accessibility/Implementing_MSAA_server","title":"Implementing a Microsoft Active Accessibility (MSAA) Server"}],"pageTitle":"Implementing a Microsoft Active Accessibility (MSAA) Server - Accessibility | MDN","noIndexing":false}}</script></body></html>